<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Single studies using the SelfControlledCaseSeries package • SelfControlledCaseSeries</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Single studies using the SelfControlledCaseSeries package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SelfControlledCaseSeries</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/MultipleAnalyses.html">Running multiple analyses at once using the SelfControlledCaseSeries package</a></li>
    <li><a class="dropdown-item" href="../articles/ResultsSchema.html">Results schema of the SelfControlledCaseSeries package</a></li>
    <li><a class="dropdown-item" href="../articles/SingleStudies.html">Single studies using the SelfControlledCaseSeries package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/SelfControlledCaseSeries/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Single studies using the SelfControlledCaseSeries package</h1>
                        <h4 data-toc-skip class="author">Martijn J.
Schuemie, Marc A. Suchard and Patrick Ryan</h4>
            
            <h4 data-toc-skip class="date">2025-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/SelfControlledCaseSeries/blob/HEAD/vignettes/SingleStudies.Rmd" class="external-link"><code>vignettes/SingleStudies.Rmd</code></a></small>
      <div class="d-none name"><code>SingleStudies.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes how you can use the
<code>SelfControlledCaseSeries</code> package to perform a single
Self-Controlled Case Series (SCCS) study. We will walk through all the
steps needed to perform an exemplar study, and we have selected the
well-studied topic of the effect of aspirin on epistaxis.</p>
<div class="section level3">
<h3 id="terminology">Terminology<a class="anchor" aria-label="anchor" href="#terminology"></a>
</h3>
<p>The following terms are used consistently throughout the package:</p>
<ul>
<li>
<strong>Case</strong>: a period of continuous observation of a
person containing one or more outcomes. One person can contribute to
multiple cases, for example when the person has multiple observation
periods.</li>
<li>
<strong>Observation period</strong>: the time when a person is
observed in the database, e.g. the time when enrolled in an insurance
plan.</li>
<li>
<strong>Nesting cohort</strong>: a cohort defining when persons are
eligible to be included as cases. This is typically the indication of
the drug. For example, if the drug treats diabetes, we may want to nest
the analysis in the time when people have diabetes to avoid
(time-varying) confounding by indication.</li>
<li>
<strong>Study period</strong>: a period of calendar time when
persons are eligible to be included as cases. For example, a study
period could be January 1, 2020, onward. Unlike nesting cohorts, which
could specify different time periods per person, a study period applies
to all persons.</li>
<li>
<strong>Naive period</strong>: the first part of a person’s
observation period (e.g. the first 180 days). This is typically removed
from the SCCS model to avoid exposure and incident outcome
misclassification. For example, if we observe the outcome on the second
day of a person’s observation period, we do not know whether the outcome
is a new one or just a follow-up for an old one, and whether the patient
may have started the exposure just prior to observation start without us
knowing about it.</li>
<li>
<strong>Study population</strong>: the set of cases having a
specific outcome, that meet certain criteria, such as the naive period
and age restrictions.</li>
<li>
<strong>Era</strong>: a data element extracted from the database
denoting a time period for a patient (a case). This can be a cohort, but
also a drug era.</li>
<li>
<strong>SCCS data</strong>: a data object containing information on
cases, observation periods, nesting cohorts, and eras.</li>
<li>
<strong>Covariate</strong>: a time-varying variable used as a
predictor for the outcome in the SCCS model. These include splines and
era covariates.</li>
<li>
<strong>Era covariate</strong>: a covariate derived from an era.
Multiple covariates can be derived from a single era (e.g. a covariate
for when on a drug, and a covariate for the pre-exposure time prior to
the drug). One covariate can be derived from multiple eras (e.g. one
covariate can represent a class of drugs).</li>
<li>
<strong>SCCS interval data</strong>: data of cases chopped into
intervals during which all covariates have a constant value. For splines
(e.g for season), the effect is assumed to be constant within each
calendar month.</li>
<li>
<strong>SCCS model</strong>: a Poisson regression of SCCS interval
data, condition on the observation period.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="installation-instructions">Installation instructions<a class="anchor" aria-label="anchor" href="#installation-instructions"></a>
</h2>
<p>Before installing the <code>SelfControlledCaseSeries</code> package
make sure you have Java available. For Windows users, RTools is also
necessary. See <a href="https://ohdsi.github.io/Hades/rSetup.html" class="external-link">these
instructions</a> for properly configuring your R environment.</p>
<p>The <code>SelfControlledCaseSeries</code> package is maintained in a
<a href="https://github.com/OHDSI/SelfControlledCaseSeries" class="external-link">Github
repository</a>, and can be downloaded and installed from within R using
the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ohdsi/SelfControlledCaseSeries"</span><span class="op">)</span> </span></code></pre></div>
<p>Once installed, you can type
<code><a href="https://ohdsi.github.io/SelfControlledCaseSeries/">library(SelfControlledCaseSeries)</a></code> to load the package.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In the <code>SelfControlledCaseSeries</code> package a study requires
at least three steps:</p>
<ol style="list-style-type: decimal">
<li><p>Loading the necessary data from the database.</p></li>
<li><p>Transforming the data into a format suitable for an SCCS study.
This step can be broken down in multiple tasks:</p></li>
</ol>
<ul>
<li>Defining a study population, people having a specific outcome, with
possible further restrictions such as age.</li>
<li>Creating covariates based on the variables extracted from the
database, such as defining risk windows based on exposures.</li>
<li>Transforming the data into non-overlapping time intervals, with
information on the various covariates and outcomes per interval.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Fitting the model using conditional Poisson regression.</li>
</ol>
<p>In the following sections these steps will be demonstrated for
increasingly complex studies.</p>
</div>
<div class="section level2">
<h2 id="studies-with-a-single-drug">Studies with a single drug<a class="anchor" aria-label="anchor" href="#studies-with-a-single-drug"></a>
</h2>
<div class="section level3">
<h3 id="configuring-the-connection-to-the-server">Configuring the connection to the server<a class="anchor" aria-label="anchor" href="#configuring-the-connection-to-the-server"></a>
</h3>
<p>We need to tell R how to connect to the server where the data are.
<code>SelfControlledCaseSeries</code> uses the
<code>DatabaseConnector</code> package, which provides the
<code>createConnectionDetails</code> function. Type
<code>?createConnectionDetails</code> for the specific settings required
for the various database management systems (DBMS). For example, one
might connect to a PostgreSQL database using this code:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">createConnectionDetails</span><span class="op">(</span>dbms <span class="op">=</span> <span class="st">"postgresql"</span>, </span>
<span>                                             server <span class="op">=</span> <span class="st">"localhost/ohdsi"</span>, </span>
<span>                                             user <span class="op">=</span> <span class="st">"joe"</span>, </span>
<span>                                             password <span class="op">=</span> <span class="st">"supersecret"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">cdmDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"my_cdm_data"</span></span>
<span><span class="va">cohortDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"my_results"</span></span>
<span><span class="va">cohortTable</span> <span class="op">&lt;-</span> <span class="st">"my_cohorts"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>sqlRenderTempEmulationSchema <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The last lines define the <code>cdmDatabaseSchema</code>,
<code>cohortDatabaseSchema</code>, and <code>cohortTable</code>
variables. We’ll use these later to tell R where the data in CDM format
live, where we have stored our cohorts of interest, and what version CDM
is used. Note that for Microsoft SQL Server,
<code>databaseSchemas</code> need to specify both the database and the
schema, so for example
<code>cdmDatabaseSchema &lt;- "my_cdm_data.dbo"</code>. For database
platforms that do not support temp tables, such as Oracle, it is also
necessary to provide a schema where the user has write access that can
be used to emulate temp tables. PostgreSQL supports temp tables, so we
can set <code>options(sqlRenderTempEmulationSchema = NULL)</code> (or
not set the <code>sqlRenderTempEmulationSchema</code> at all.)</p>
</div>
<div class="section level3">
<h3 id="preparing-the-exposure-and-outcome-of-interest">Preparing the exposure and outcome of interest<a class="anchor" aria-label="anchor" href="#preparing-the-exposure-and-outcome-of-interest"></a>
</h3>
<p>We need to define the exposure and outcome for our study. For the
exposure, we will directly use the <code>drug_era</code> table in the
CDM. For the outcome we can use the OHDSI <code>PhenotypeLibrary</code>
package to retrieve a community-approved definition of epistaxis:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">epistaxis</span> <span class="op">&lt;-</span> <span class="fl">356</span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">PhenotypeLibrary</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PhenotypeLibrary/reference/getPlCohortDefinitionSet.html" class="external-link">getPlCohortDefinitionSet</a></span><span class="op">(</span><span class="va">epistaxis</span><span class="op">)</span></span></code></pre></div>
<p>We can use the <code>CohortGenerator</code> package to instantiate
this cohort:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span><span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/getCohortTableNames.html" class="external-link">getCohortTableNames</a></span><span class="op">(</span><span class="va">cohortTable</span><span class="op">)</span></span>
<span><span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/createCohortTables.html" class="external-link">createCohortTables</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                                    cohortDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>                                    cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/generateCohortSet.html" class="external-link">generateCohortSet</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                                             cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>                                             cohortDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>                                             cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,</span>
<span>                                             cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/disconnect.html" class="external-link">disconnect</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="extracting-the-data-from-the-server">Extracting the data from the server<a class="anchor" aria-label="anchor" href="#extracting-the-data-from-the-server"></a>
</h3>
<p>Now we can tell <code>SelfControlledCaseSeries</code> to extract all
necessary data for our analysis:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">aspirin</span> <span class="op">&lt;-</span> <span class="fl">1112807</span></span>
<span></span>
<span><span class="va">sccsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  outcomeIds <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"drug_era"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createGetDbSccsDataArgs.html">createGetDbSccsDataArgs</a></span><span class="op">(</span></span>
<span>    studyStartDates <span class="op">=</span> <span class="st">"20100101"</span>,</span>
<span>    studyEndDates <span class="op">=</span> <span class="st">"21000101"</span>,</span>
<span>    maxCasesPerOutcome <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>    exposureIds <span class="op">=</span> <span class="va">aspirin</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sccsData</span></span></code></pre></div>
<pre><code><span><span class="co">## # SccsData object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exposure cohort ID(s): 1112807</span></span>
<span><span class="co">## Outcome cohort ID(s): 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Inherits from Andromeda:</span></span>
<span><span class="co">## <span style="color: #949494;"># Andromeda object</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Physical location:  E:\andromedaTemp\file2fb04712e5e.duckdb</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tables:</span></span>
<span><span class="co">## $cases (observationPeriodId, caseId, personId, noninformativeEndCensor, observationPeriodStartDate, startDay, endDay, ageAtObsStart, genderConceptId)</span></span>
<span><span class="co">## $eraRef (eraType, eraId, eraName, minObservedDate, maxObservedDate)</span></span>
<span><span class="co">## $eras (eraType, caseId, eraId, eraValue, eraStartDay, eraEndDay)</span></span></code></pre>
<p>There are many parameters, but they are all documented in the
<code>SelfControlledCaseSeries</code> manual. In short, we are pointing
the function to the table created earlier and indicating which cohort ID
in that table identifies the outcome. Note that it is possible to fetch
the data for multiple outcomes at once. We further point the function to
the <code>drug_era</code> table, and specify the concept ID of our
exposure of interest: aspirin. Again, note that it is also possible to
fetch data for multiple drugs at once. In fact, when we do not specify
any exposure IDs the function will retrieve the data for all the drugs
found in the <code>drug_era</code> table.</p>
<p>All data about the patients, outcomes and exposures are extracted
from the server and stored in the <code>sccsData</code> object. This
object uses the <code>Andromeda</code> package to store information in a
way that ensures R does not run out of memory, even when the data are
large.</p>
<p>We can use the generic <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> function to view some
more information of the data we extracted:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sccsData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsData object summary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exposure cohort ID(s): 1112807</span></span>
<span><span class="co">## Outcome cohort ID(s): 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome counts:</span></span>
<span><span class="co">##     Outcome Subjects Outcome Events Outcome Observation Periods</span></span>
<span><span class="co">## 356            99202         160949                       1e+05</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Eras:</span></span>
<span><span class="co">## Number of era types: 2</span></span>
<span><span class="co">## Number of eras: 169627</span></span></code></pre>
<div class="section level4">
<h4 id="saving-the-data-to-file">Saving the data to file<a class="anchor" aria-label="anchor" href="#saving-the-data-to-file"></a>
</h4>
<p>Creating the <code>sccsData</code> file can take considerable
computing time, and it is probably a good idea to save it for future
sessions. Because <code>sccsData</code> uses <code>Andromeda</code>, we
cannot use R’s regular save function. Instead, we’ll have to use the
<code><a href="../reference/saveSccsData.html">saveSccsData()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/saveSccsData.html">saveSccsData</a></span><span class="op">(</span><span class="va">sccsData</span>, <span class="st">"sccsData.zip"</span><span class="op">)</span></span></code></pre></div>
<p>We can use the <code><a href="../reference/loadSccsData.html">loadSccsData()</a></code> function to load the data
in a future session.</p>
</div>
</div>
<div class="section level3">
<h3 id="creating-the-study-population">Creating the study population<a class="anchor" aria-label="anchor" href="#creating-the-study-population"></a>
</h3>
<p>From the data fetched from the server we can now define the
population we wish to study. If we retrieved data for multiple outcomes,
we should now select only one, and possibly impose further
restrictions:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">studyPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createStudyPopulation.html">createStudyPopulation</a></span><span class="op">(</span></span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  outcomeId <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateStudyPopulationArgs.html">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>    firstOutcomeOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    naivePeriod <span class="op">=</span> <span class="fl">180</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here we specify we wish to study the outcome with the ID stored in
<code>epistaxis</code>. Since this was the only outcome for which we
fetched the data, we could also have skipped this argument. We
furthermore specify that the first 180 days of observation of every
person, the so-called ‘naive period’, will be excluded from the
analysis. Note that data in the naive period will be used to determine
exposure status at the start of follow-up (after the end of the naive
period). We also specify we will use all occurrences of the outcome, not
just the first one per person.</p>
<p>We can find out how many people (if any) were removed by any
restrictions we imposed:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/getAttritionTable.html">getAttritionTable</a></span><span class="op">(</span><span class="va">studyPop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   outcomeId outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 1       356          325890        507256            331800   1211954076</span></span>
<span><span class="co">## 2       356          207698        323114            211321    573067241</span></span>
<span><span class="co">## 3       356           99202        160949            100000    285343718</span></span>
<span><span class="co">## 4       356           87836        135825             88453    240007225</span></span>
<span><span class="co">##                       description</span></span>
<span><span class="co">## 1         All outcome occurrences</span></span>
<span><span class="co">## 2     Outcomes in study period(s)</span></span>
<span><span class="co">## 3                   Random sample</span></span>
<span><span class="co">## 4 Requiring 180 days naive period</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="defining-a-simple-model">Defining a simple model<a class="anchor" aria-label="anchor" href="#defining-a-simple-model"></a>
</h3>
<p>Next, we can use the data to define a simple model to fit:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covarAspirin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Exposure of interest"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="va">aspirin</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era end"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span>  <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="va">covarAspirin</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sccsIntervalData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsIntervalData object summary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome cohort ID: 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Number of cases (observation periods): 88451</span></span>
<span><span class="co">## Number of eras (spans of time): 180752</span></span>
<span><span class="co">## Number of outcomes: 135823</span></span>
<span><span class="co">## Number of covariates: 2</span></span>
<span><span class="co">## Number of non-zero covariate values: 93011</span></span></code></pre>
<p>In this example, we use the <code><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings()</a></code>
function to define a single covariate: exposure to aspirin. We specify
that the risk window is from start of exposure to the end by setting
start and end to 0, and defining the anchor for the end to be the era
end, which for drug eras is the end of exposure.</p>
<p>We then use the covariate definition in the
<code><a href="../reference/createSccsIntervalData.html">createSccsIntervalData()</a></code> function to generate the
<code>sccsIntervalData</code>. This represents the data in
non-overlapping time intervals, with information on the various
covariates and outcomes per interval.</p>
</div>
<div class="section level3">
<h3 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h3>
<p>The <code>fitSccsModel</code> function is used to fit the model:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can inspect the resulting model:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsModel object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome ID: 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome count:</span></span>
<span><span class="co">##     outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 356           87834        135823             88451    148669525</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">##   Name                         ID Estimate LB95CI UB95CI  LogRr SeLogRr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> End of observation period    99     1.05   1.01   1.08 0.044<span style="text-decoration: underline;">1</span>  0.016<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Exposure of interest       <span style="text-decoration: underline;">1</span>000     1.38   1.27   1.51 0.324   0.043<span style="text-decoration: underline;">9</span></span></span></code></pre>
<p>This tells us what the estimated relative risk (the incidence rate
ratio) is during exposure to aspirin compared to non-exposed time.</p>
</div>
<div class="section level3">
<h3 id="adding-a-pre-exposure-window">Adding a pre-exposure window<a class="anchor" aria-label="anchor" href="#adding-a-pre-exposure-window"></a>
</h3>
<p>One key assumption of the SCCS design is that the outcome does not
change the subsequent probability of exposure. In this case, this
assumption may be violated, because doctors may hesitate to prescribe
aspirin to someone who is prone to bleeding. To ensure this does not
affect our analysis, we must include a window prior to exposure. We can
then test whether the rate of the outcome is increased or decreased
during this pre-exposure window. Because the exposure hasn’t occurred
yet, it cannot cause a change in risk. Any observed change must
therefore be due to other, possibly confounding factors. We add a 30-day
pre-exposure window:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covarPreAspirin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Pre-exposure"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="va">aspirin</span>,</span>
<span>  start <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>,</span>
<span>  end <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era start"</span>,</span>
<span>  preExposure <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarAspirin</span>, <span class="va">covarPreAspirin</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here we created a new covariate definition in addition to the first
one. We define the risk window to start 60 days prior to exposure, and
end on the day just prior to exposure. We designate the covariate as
<code>preExposure = TRUE</code>, meaning it will be used for the
pre-exposure diagnostic evaluating the assumption that event and
subsequent exposure are independent. We combine the two covariate
settings in a list for the <code>createSccsIntervalData</code> function.
Again, we can take a look at the results:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsModel object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome ID: 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome count:</span></span>
<span><span class="co">##     outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 356           87834        135823             88451    148669525</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">##   Name                         ID Estimate LB95CI UB95CI  LogRr SeLogRr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> End of observation period    99     1.05   1.01   1.08 0.044<span style="text-decoration: underline;">8</span>  0.016<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Exposure of interest       <span style="text-decoration: underline;">1</span>000     1.44   1.32   1.57 0.363   0.044<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Pre-exposure               <span style="text-decoration: underline;">1</span>001     1.37   1.23   1.52 0.312   0.054<span style="text-decoration: underline;">7</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="including-seasonality-and-calendar-time">Including seasonality, and calendar time<a class="anchor" aria-label="anchor" href="#including-seasonality-and-calendar-time"></a>
</h3>
<p>Often both the rate of exposure and the outcome change with age, and
can even depend on the season or calendar time in general (e.g. rates
may be higher in 2021 compared to 2020). This may lead to confounding
and may bias our estimates. To correct for this we can include age,
season, and/or calendar time into the model.</p>
<p>For computational reasons we assume the effect of age, season, and
calendar time are constant within each calendar month. We assume that
the rate from one month to the next can be different, but we also assume
that subsequent months have somewhat similar rates. This is implemented
by using spline functions.</p>
<p><img src="spline.png" alt="Spline for seasonality"><em>Figure
1</em>. Example of how a spline is used for seasonality: within a month,
the risk attributable to seasonality is assumed to be constant, but from
month to month the risks are assumed to follow a cyclic quadratic
spline.</p>
<p>Note that by default all people that have the outcome will be used to
estimate the effect of age, seasonality, and calendar time on the
outcome, so not just the people exposed to the drug of interest.
Adjusting for age typically only makes sense for small children, where a
small difference in age can still make a big difference (remember: we
are modeling the effect of age in each person by themselves, not the
effect of age across persons). Since age and calendar time are often
hard to fit simultaneously, it is often best to only model seasonality
and calendar time, like this:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seasonalityCovariateSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSeasonalityCovariateSettings.html">createSeasonalityCovariateSettings</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">calendarTimeSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCalendarTimeCovariateSettings.html">createCalendarTimeCovariateSettings</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarAspirin</span>,</span>
<span>                                <span class="va">covarPreAspirin</span><span class="op">)</span>,</span>
<span>    seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalityCovariateSettings</span>,</span>
<span>    calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Again, we can inspect the model:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsModel object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome ID: 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome count:</span></span>
<span><span class="co">##     outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 356           13265         20611             13284     23509810</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 12 × 7</span></span></span>
<span><span class="co">##    Name                                ID Estimate LB95CI UB95CI   LogRr SeLogRr</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> End of observation period           99    0.837  0.767  0.912 -<span style="color: #BB0000;">0.178</span>   0.044<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Seasonality spline component 1     200    1.37  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.314  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Seasonality spline component 2     201    1.59  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.466  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Seasonality spline component 3     202    1.24  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.218  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Seasonality spline component 4     203    0.801 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">0.222</span>  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Calendar time spline component 1   300    1.07  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.065<span style="text-decoration: underline;">6</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Calendar time spline component 2   301    1.51  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.415  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Calendar time spline component 3   302    2.14  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.760  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> Calendar time spline component 4   303    2.85  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1.05   <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Calendar time spline component 5   304    3.20  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      1.16   <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> Exposure of interest              <span style="text-decoration: underline;">1</span>000    1.39   1.27   1.51   0.326   0.044<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> Pre-exposure                      <span style="text-decoration: underline;">1</span>001    1.33   1.19   1.47   0.282   0.054<span style="text-decoration: underline;">6</span></span></span></code></pre>
<p>We see that our estimates for exposed and pre-exposure time have not
changes much. We can plot the spline curves for season, and calendar
time to learn more:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotSeasonality.html">plotSeasonality</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotCalendarTimeEffect.html">plotCalendarTimeEffect</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
<p>We see some effect for season: epistaxis tends to be more prevalent
during winter. We should verify if our model accounts for time trends,
by plotting the observed to expected rate of the outcome across time,
before and after adjustment:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotEventToCalendarTime.html">plotEventToCalendarTime</a></span><span class="op">(</span>studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>                        sccsModel <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-31-1.png" width="700"></p>
<p>Here we see that after adjustment, in general, the rate of outcome
appears fairly stable across time, with the exception of some months in
2020. This is what we refer to as the ‘COVID-blip’, because during the
time of the COVID-19 pandemic regular healthcare was put on hold.</p>
</div>
<div class="section level3">
<h3 id="removing-the-covid-blip">Removing the COVID blip<a class="anchor" aria-label="anchor" href="#removing-the-covid-blip"></a>
</h3>
<p>The discontinuity in the rate of the outcome during the COVID
pandemic could cause bias. For this reason it is probably best to remove
this time from the analysis altogether. We can achieve this by defining
two separate study periods:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  outcomeIds <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"drug_era"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createGetDbSccsDataArgs.html">createGetDbSccsDataArgs</a></span><span class="op">(</span></span>
<span>    exposureIds <span class="op">=</span> <span class="va">aspirin</span>,</span>
<span>    maxCasesPerOutcome <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>    studyStartDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20100101"</span>, <span class="st">"20220101"</span><span class="op">)</span>,</span>
<span>    studyEndDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20191231"</span>, <span class="st">"21001231"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">studyPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createStudyPopulation.html">createStudyPopulation</a></span><span class="op">(</span></span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  outcomeId <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateStudyPopulationArgs.html">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>    firstOutcomeOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    naivePeriod <span class="op">=</span> <span class="fl">180</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarAspirin</span>,</span>
<span>                                <span class="va">covarPreAspirin</span><span class="op">)</span>,</span>
<span>    seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalityCovariateSettings</span>,</span>
<span>    calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>If we plot the outcomes over time, we see the entire time of the
COVID pandemic has been removed:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotEventToCalendarTime.html">plotEventToCalendarTime</a></span><span class="op">(</span>studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>                        sccsModel <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-34-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="considering-event-dependent-observation-time">Considering event-dependent observation time<a class="anchor" aria-label="anchor" href="#considering-event-dependent-observation-time"></a>
</h3>
<p>The SCCS method requires that observation periods are independent of
outcome times. This requirement is violated when outcomes increase the
mortality rate, since censoring of the observation periods is then
event-dependent. A modification to the SCCS has been proposed that
attempts to correct for this. First, several models are fitted to
estimate the amount and shape of the event-dependent censoring, and the
best fitting model is selected. Next, this model is used to reweigh
various parts of the observation time. This approach is also implemented
in this package, and can be turned on using the
<code>eventDependentObservation</code> argument of the
<code>createSccsIntervalData</code> function. However, this method has
proven to be somewhat unstable in combinations with other corrections,
so for now it is best to keep the model simple:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarAspirin</span>,</span>
<span>                                <span class="va">covarPreAspirin</span><span class="op">)</span>,</span>
<span>    eventDependentObservation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Again, we can inspect the model:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsModel object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome ID: 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome count:</span></span>
<span><span class="co">##     outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 356           34266         53069             34387     10666039</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 3 × 7</span></span></span>
<span><span class="co">##   Name                         ID Estimate LB95CI UB95CI  LogRr SeLogRr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> End of observation period    99    0.580  0.562  0.599 -<span style="color: #BB0000;">0.544</span>  0.016<span style="text-decoration: underline;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Exposure of interest       <span style="text-decoration: underline;">1</span>000    1.40   1.17   1.68   0.340  0.091<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Pre-exposure               <span style="text-decoration: underline;">1</span>001    1.24   0.983  1.55   0.217  0.117</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="studies-with-more-than-one-drug">Studies with more than one drug<a class="anchor" aria-label="anchor" href="#studies-with-more-than-one-drug"></a>
</h2>
<p>Although we are usually interested in the effect of a single drug or
drug class, it could be beneficial to add exposure to other drugs to the
analysis if we believe those drugs represent time-varying confounders
that we wish to correct for.</p>
<div class="section level3">
<h3 id="adding-a-class-of-drugs">Adding a class of drugs<a class="anchor" aria-label="anchor" href="#adding-a-class-of-drugs"></a>
</h3>
<p>For example, SSRIs might also cause epistaxis, and if aspirin is
co-prescribed with SSRIs we don’t want the effect of SSRIs attributed to
aspirin. We would like our estimate to represent just the effect of the
aspirin, so we need to keep the effect of the SSRIs separate. First we
have to retrieve the information on SSRI exposure from the database:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssris</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">715939</span>, <span class="fl">722031</span>, <span class="fl">739138</span>, <span class="fl">751412</span>, <span class="fl">755695</span>, <span class="fl">797617</span>, <span class="fl">40799195</span><span class="op">)</span></span>
<span><span class="va">sccsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  outcomeIds <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"drug_era"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createGetDbSccsDataArgs.html">createGetDbSccsDataArgs</a></span><span class="op">(</span></span>
<span>    maxCasesPerOutcome <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>    exposureIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">aspirin</span>, <span class="va">ssris</span><span class="op">)</span>,</span>
<span>    studyStartDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20100101"</span>, <span class="st">"20220101"</span><span class="op">)</span>,</span>
<span>    studyEndDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20191231"</span>, <span class="st">"21001231"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sccsData</span></span></code></pre></div>
<pre><code><span><span class="co">## # SccsData object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Exposure cohort ID(s): 1112807,715939,722031,739138,751412,755695,797617,40799195</span></span>
<span><span class="co">## Outcome cohort ID(s): 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Inherits from Andromeda:</span></span>
<span><span class="co">## <span style="color: #949494;"># Andromeda object</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Physical location:  E:\andromedaTemp\file2fb03e6951b3.duckdb</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Tables:</span></span>
<span><span class="co">## $cases (observationPeriodId, caseId, personId, noninformativeEndCensor, observationPeriodStartDate, startDay, endDay, ageAtObsStart, genderConceptId)</span></span>
<span><span class="co">## $eraRef (eraType, eraId, eraName, minObservedDate, maxObservedDate)</span></span>
<span><span class="co">## $eras (eraType, caseId, eraId, eraValue, eraStartDay, eraEndDay)</span></span></code></pre>
<p>Once retrieved, we can use the data to build and fit our model:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">studyPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createStudyPopulation.html">createStudyPopulation</a></span><span class="op">(</span></span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  outcomeId <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateStudyPopulationArgs.html">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>    firstOutcomeOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    naivePeriod <span class="op">=</span> <span class="fl">180</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">covarSsris</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span>label <span class="op">=</span> <span class="st">"SSRIs"</span>,</span>
<span>                                         includeEraIds <span class="op">=</span> <span class="va">ssris</span>,</span>
<span>                                         stratifyById <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                         start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                         end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                         endAnchor <span class="op">=</span> <span class="st">"era end"</span><span class="op">)</span></span>
<span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarAspirin</span>,</span>
<span>                                <span class="va">covarPreAspirin</span>,</span>
<span>                                <span class="va">covarSsris</span><span class="op">)</span>,</span>
<span>    seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalityCovariateSettings</span>,</span>
<span>    calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here, we added a new covariate based on the list of concept IDs for
the various SSRIs. In this example we set <code>stratifyById</code> to
<code>FALSE</code>, meaning that we will estimate a single incidence
rate ratio for all SSRIs, so one estimate for the entire class of drugs.
Note that duplicates will be removed: if a person is exposed to two
SSRIs on the same day, this will be counted only once when fitting the
model. Again, we can inspect the model:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsModel object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome ID: 356</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome count:</span></span>
<span><span class="co">##     outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 356           30912         47101             31005     52326829</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 14 × 7</span></span></span>
<span><span class="co">##    Name                                ID Estimate LB95CI UB95CI   LogRr SeLogRr</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> End of observation period           99    0.824  0.778  0.873 -<span style="color: #BB0000;">0.193</span>   0.029<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Seasonality spline component 1     200    1.36  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.306  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Seasonality spline component 2     201    1.62  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.484  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Seasonality spline component 3     202    1.19  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.170  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> Seasonality spline component 4     203    0.830 <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>     -<span style="color: #BB0000;">0.186</span>  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Calendar time spline component 1   300    1.04  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.035<span style="text-decoration: underline;">7</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Calendar time spline component 2   301    1.32  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.278  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Calendar time spline component 3   302    1.74  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.555  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> Calendar time spline component 4   303    2.04  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.714  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Calendar time spline component 5   304    2.58  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.946  <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span> Calendar time spline component 6   305    1.04  <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>      0.042<span style="text-decoration: underline;">2</span> <span style="color: #BB0000;">NA</span>     </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">12</span> Exposure of interest              <span style="text-decoration: underline;">1</span>000    1.34   1.23   1.46   0.292   0.043<span style="text-decoration: underline;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">13</span> Pre-exposure                      <span style="text-decoration: underline;">1</span>001    1.28   1.16   1.42   0.251   0.053<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">14</span> SSRIs                             <span style="text-decoration: underline;">1</span>002    1.03   0.994  1.06   0.025<span style="text-decoration: underline;">9</span>  0.016<span style="text-decoration: underline;">3</span></span></span></code></pre>
</div>
<div class="section level3">
<h3 id="adding-all-drugs">Adding all drugs<a class="anchor" aria-label="anchor" href="#adding-all-drugs"></a>
</h3>
<p>Another approach could be to add all drugs into the model. Again, the
first step is to get all the relevant data from the database:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  outcomeIds <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"drug_era"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createGetDbSccsDataArgs.html">createGetDbSccsDataArgs</a></span><span class="op">(</span></span>
<span>    exposureIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    maxCasesPerOutcome <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>    studyStartDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"19000101"</span>, <span class="st">"20220101"</span><span class="op">)</span>,</span>
<span>    studyEndDates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"20191231"</span>, <span class="st">"21001231"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that the <code>exposureIds</code> argument is left empty. This
will cause data for all concepts in the exposure table to be retrieved.
Next, we simply create a new set of covariates, and fit the model:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">studyPop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createStudyPopulation.html">createStudyPopulation</a></span><span class="op">(</span></span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  outcomeId <span class="op">=</span> <span class="va">epistaxis</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateStudyPopulationArgs.html">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>    firstOutcomeOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    naivePeriod <span class="op">=</span> <span class="fl">180</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">covarAllDrugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Other exposures"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  excludeEraIds <span class="op">=</span> <span class="va">aspirin</span>,</span>
<span>  stratifyById <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era end"</span>,</span>
<span>  allowRegularization <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">sccsIntervalData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsIntervalData.html">createSccsIntervalData</a></span><span class="op">(</span></span>
<span>  studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>  sccsData <span class="op">=</span> <span class="va">sccsData</span>,</span>
<span>  createSccsIntervalDataArgs <span class="op">=</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>    eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">covarAspirin</span>,</span>
<span>                                <span class="va">covarPreAspirin</span>,</span>
<span>                                <span class="va">covarAllDrugs</span><span class="op">)</span>,</span>
<span>    seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalityCovariateSettings</span>,</span>
<span>    calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span><span class="op">(</span></span>
<span>  sccsIntervalData <span class="op">=</span> <span class="va">sccsIntervalData</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The first thing to note is that we have defined the new covariates to
be all drugs except aspirin by not specifying the
<code>includeEraIds</code> and setting the <code>excludeEraIds</code> to
the concept ID of aspirin. Furthermore, we have specified that
<code>stratifyById</code> is TRUE, meaning an estimate will be produced
for each drug.</p>
<p>We have set <code>allowRegularization</code> to <code>TRUE</code>,
meaning we will use regularization for all estimates in this new
covariate set. Regularization means we will impose a prior distribution
on the effect size, effectively penalizing large estimates. This helps
fit the model, for example when some drugs are rare, and when drugs are
almost often prescribed together and their individual effects are
difficult to untangle.</p>
<p>Because there are now so many estimates, we will export all estimates
to a data frame using <code><a href="../reference/getModel.html">getModel()</a></code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModel.html">getModel</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span><span class="va">estimates</span><span class="op">[</span><span class="va">estimates</span><span class="op">$</span><span class="va">originalEraId</span> <span class="op">==</span> <span class="va">aspirin</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 10</span></span></span>
<span><span class="co">##   name     id estimate lb95Ci ub95Ci logRr seLogRr originalEraId originalEraType</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Expo…  <span style="text-decoration: underline;">1</span>000     1.31   1.17   1.47 0.270  0.057<span style="text-decoration: underline;">7</span>       1<span style="text-decoration: underline;">112</span>807 <span style="color: #949494;">""</span>             </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Pre-…  <span style="text-decoration: underline;">1</span>001     1.31   1.17   1.47 0.271  0.058<span style="text-decoration: underline;">3</span>       1<span style="text-decoration: underline;">112</span>807 <span style="color: #949494;">""</span>             </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 1 more variable: originalEraName &lt;chr&gt;</span></span></span></code></pre>
<p>Here we see that despite the extensive adjustments that are made in
the model, the effect estimates for aspirin have remained nearly the
same.</p>
<p>In case we’re interested, we can also look at the effect sizes for
the SSRIs:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimates</span><span class="op">[</span><span class="va">estimates</span><span class="op">$</span><span class="va">originalEraId</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">ssris</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">##   name                  id estimate lb95Ci ub95Ci    logRr seLogRr originalEraId</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> Other exposures: …  <span style="text-decoration: underline;">1</span>119    1.02      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  0.020<span style="text-decoration: underline;">8</span>       <span style="color: #BB0000;">NA</span>        <span style="text-decoration: underline;">739</span>138</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Other exposures: …  <span style="text-decoration: underline;">1</span>868    1.02      <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span>  0.019<span style="text-decoration: underline;">2</span>       <span style="color: #BB0000;">NA</span>        <span style="text-decoration: underline;">755</span>695</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Other exposures: …  <span style="text-decoration: underline;">2</span>404    0.993     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.007</span><span style="color: #BB0000; text-decoration: underline;">38</span>      <span style="color: #BB0000;">NA</span>        <span style="text-decoration: underline;">797</span>617</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Other exposures: …  <span style="text-decoration: underline;">2</span>697    0.972     <span style="color: #BB0000;">NA</span>     <span style="color: #BB0000;">NA</span> -<span style="color: #BB0000;">0.028</span><span style="color: #BB0000; text-decoration: underline;">9</span>       <span style="color: #BB0000;">NA</span>        <span style="text-decoration: underline;">715</span>939</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: originalEraType &lt;chr&gt;, originalEraName &lt;chr&gt;</span></span></span></code></pre>
<p>Note that because we used regularization, we are not able to compute
the confidence intervals for these estimates.</p>
</div>
</div>
<div class="section level2">
<h2 id="diagnostics-for-the-main-sccs-assumptions">Diagnostics for the main SCCS assumptions<a class="anchor" aria-label="anchor" href="#diagnostics-for-the-main-sccs-assumptions"></a>
</h2>
<p>We can perform several diagnostics on the data to verify whether the
assumptions underlying the SCCS are met. There are four major
assumptions:</p>
<ol style="list-style-type: decimal">
<li>Occurrences of the event are independent or rare. Events within an
individual are seldom independent because serious health outcomes often
increase the likelihood of recurrence. Restricting analyses to the first
event avoids dependency but assumes that the outcome is rare.</li>
<li>Occurrence of the event does not affect subsequent exposures.</li>
<li>End of observation is independent of the occurrence of the
outcome.</li>
<li>Modeling assumptions are correct. Here we specifically focus on
whether the effect of time has been modeled correctly.</li>
</ol>
<p>The <code>SelfControlledCaseSeries</code> package provides functions
to test each of these assumptions:</p>
<div class="section level3">
<h3 id="rare-outcome-assumption-diagnostic">Rare outcome assumption diagnostic<a class="anchor" aria-label="anchor" href="#rare-outcome-assumption-diagnostic"></a>
</h3>
<p>Diagnostic: The proportion of individuals experiencing the outcome
should be less than 10%.</p>
<p>To evaluate this assumption, we can call the
<code><a href="../reference/checkRareOutcomeAssumption.html">checkRareOutcomeAssumption()</a></code> function:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkRareOutcomeAssumption.html">checkRareOutcomeAssumption</a></span><span class="op">(</span><span class="va">studyPop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   outcomeProportion firstOutcomeOnly pass </span></span>
<span><span class="co">##               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>            0.022<span style="text-decoration: underline;">1</span> FALSE            TRUE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="event-exposure-independence-assumption-diagnostic">Event-exposure independence assumption diagnostic<a class="anchor" aria-label="anchor" href="#event-exposure-independence-assumption-diagnostic"></a>
</h3>
<p>Diagnostic: The estimated IRR for the pre-exposure window should not
be significantly greater than 1.25 or smaller than 0.80.</p>
<p>This assumes we created a covariate for the pre-exposure window,
which we did in this vignette. Calling
<code><a href="../reference/checkEventExposureIndependenceAssumption.html">checkEventExposureIndependenceAssumption()</a></code> will extract the
estimate for the pre-exposure window, and compare it to the specified
null hypothesis:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkEventExposureIndependenceAssumption.html">checkEventExposureIndependenceAssumption</a></span><span class="op">(</span>sccsModel <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">##   ratio    lb    ub pass </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>  1.31  1.17  1.47 TRUE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="event-observation-independence-assumption-diagnostic">Event-observation independence assumption diagnostic<a class="anchor" aria-label="anchor" href="#event-observation-independence-assumption-diagnostic"></a>
</h3>
<p>Diagnostic: The estimated IRR for the end-of-observation probe should
not be significantly greater than 2.00 or smaller than 0.50.</p>
<p>By default, the <code><a href="../reference/createSccsIntervalData.html">createSccsIntervalData()</a></code> function adds a
probe window at the end of the observation period. If this window shows
an effect on the outcome, there is event-observation dependency. We can
check this using
<code><a href="../reference/checkEventObservationIndependenceAssumption.html">checkEventObservationIndependenceAssumption()</a></code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkEventObservationIndependenceAssumption.html">checkEventObservationIndependenceAssumption</a></span><span class="op">(</span>sccsModel <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 4</span></span></span>
<span><span class="co">##   ratio    lb    ub pass </span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0.903 0.873 0.935 TRUE</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="modeling-assumptions-diagnostic">Modeling assumptions diagnostic<a class="anchor" aria-label="anchor" href="#modeling-assumptions-diagnostic"></a>
</h3>
<p>Diagnostic: The mean monthly absolute observed to expected ratio
should not be significantly greater than 1.10.</p>
<p>To assess the accuracy of our calendar time and seasonality modeling,
we compare the expected number of outcomes under the model to the
observed number of outcomes for each month. This helps identify
potential miscalibrations in the model’s ability to capture temporal
patterns in event occurrence. Before, we showed how
<code><a href="../reference/plotEventToCalendarTime.html">plotEventToCalendarTime()</a></code> can be used to plot the observed
to expected ratio per month, with or without the effect of the spline
adjustments. We can also perform a statistical test against the
pre-defined threshold to verify we meet the assumption:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/checkTimeStabilityAssumption.html">checkTimeStabilityAssumption</a></span><span class="op">(</span>studyPopulation <span class="op">=</span> <span class="va">studyPop</span>,</span>
<span>                             sccsModel <span class="op">=</span> <span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   ratio     p stable</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>  1.06     1 TRUE</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="additional-diagnostics">Additional diagnostics<a class="anchor" aria-label="anchor" href="#additional-diagnostics"></a>
</h2>
<div class="section level3">
<h3 id="power-calculations">Power calculations<a class="anchor" aria-label="anchor" href="#power-calculations"></a>
</h3>
<p>We might be interested to know whether we have sufficient power to
detect a particular effect size. It makes sense to perform these power
calculations once the study population has been fully defined, so taking
into account loss to the various inclusion and exclusion criteria. This
means we will use the <code>sccsIntervalData</code> object we’ve just
created as the basis for our power calculations. Since the sample size
is fixed in retrospective studies (the data has already been collected),
and the true effect size is unknown, the
<code>SelfControlledCaseSeries</code> package provides a function to
compute the minimum detectable relative risk (MDRR) instead:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/computeMdrr.html">computeMdrr</a></span><span class="op">(</span><span class="va">sccsIntervalData</span>,</span>
<span>            exposureCovariateId <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>            alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>            power <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>            twoSided <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>            method <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 5</span></span></span>
<span><span class="co">##   timeExposed timeTotal propTimeExposed events  mdrr</span></span>
<span><span class="co">##         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1<span style="text-decoration: underline;">054</span>001  10<span style="text-decoration: underline;">245</span>499           0.103   <span style="text-decoration: underline;">5</span>961  1.12</span></span></code></pre>
<p>Note that we have to provide the covariate ID of the exposure of
interest, which we learned by calling <code>summary</code> on
<code>sccsIntervalData</code> earlier. This is because we may have many
covariates in our model, but will likely only be interested in the MDRR
of one.</p>
</div>
<div class="section level3">
<h3 id="time-from-exposure-start-to-event">Time from exposure start to event<a class="anchor" aria-label="anchor" href="#time-from-exposure-start-to-event"></a>
</h3>
<p>To gain a better understanding of when the event occurs relative to
the start of exposure, we can plot their relationship:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotExposureCentered.html">plotExposureCentered</a></span><span class="op">(</span><span class="va">studyPop</span>, <span class="va">sccsData</span>, exposureEraId <span class="op">=</span> <span class="va">aspirin</span><span class="op">)</span></span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-61-1.png" width="624"></p>
</div>
<div class="section level3">
<h3 id="ages-covered-per-subject">Ages covered per subject<a class="anchor" aria-label="anchor" href="#ages-covered-per-subject"></a>
</h3>
<p>We can visualize which age ranges are covered by each subject’s
observation time:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plotAgeSpans.html">plotAgeSpans</a></span><span class="op">(</span><span class="va">studyPop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in plotAgeSpans(studyPop): There are 88453 cases. Random sampling 10000</span></span>
<span><span class="co">## cases.</span></span></code></pre>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-63-1.png" width="700"></p>
<p>Here we see that most observation periods span only a small age
range, making it unlikely that any within-person age-related effect will
be large.</p>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>Considerable work has been dedicated to provide the
<code>SelfControlledCaseSeries</code> package.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"SelfControlledCaseSeries"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## To cite package 'SelfControlledCaseSeries' in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Schuemie M, Ryan P, Shaddox T, Suchard M (2025).</span></span>
<span><span class="co">##   _SelfControlledCaseSeries: Self-Controlled Case Series_. R package</span></span>
<span><span class="co">##   version 6.0.0, https://github.com/OHDSI/SelfControlledCaseSeries,</span></span>
<span><span class="co">##   &lt;https://ohdsi.github.io/SelfControlledCaseSeries/&gt;.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Manual{,</span></span>
<span><span class="co">##     title = {SelfControlledCaseSeries: Self-Controlled Case Series},</span></span>
<span><span class="co">##     author = {Martijn Schuemie and Patrick Ryan and Trevor Shaddox and Marc Suchard},</span></span>
<span><span class="co">##     year = {2025},</span></span>
<span><span class="co">##     note = {R package version 6.0.0, </span></span>
<span><span class="co">## https://github.com/OHDSI/SelfControlledCaseSeries},</span></span>
<span><span class="co">##     url = {https://ohdsi.github.io/SelfControlledCaseSeries/},</span></span>
<span><span class="co">##   }</span></span></code></pre>
<p>Furthermore, <code>SelfControlledCaseSeries</code> makes extensive
use of the <code>Cyclops</code> package.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"Cyclops"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## To cite Cyclops in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Suchard MA, Simpson SE, Zorych I, Ryan P, Madigan D (2013). "Massive</span></span>
<span><span class="co">##   parallelization of serial inference algorithms for complex</span></span>
<span><span class="co">##   generalized linear models." _ACM Transactions on Modeling and</span></span>
<span><span class="co">##   Computer Simulation_, *23*, 10. doi:10.1145/2414416.2414791</span></span>
<span><span class="co">##   &lt;https://doi.org/10.1145/2414416.2414791&gt;.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Article{,</span></span>
<span><span class="co">##     author = {M. A. Suchard and S. E. Simpson and I. Zorych and P. Ryan and D. Madigan},</span></span>
<span><span class="co">##     title = {Massive parallelization of serial inference algorithms for complex generalized linear models},</span></span>
<span><span class="co">##     journal = {ACM Transactions on Modeling and Computer Simulation},</span></span>
<span><span class="co">##     volume = {23},</span></span>
<span><span class="co">##     pages = {10},</span></span>
<span><span class="co">##     year = {2013},</span></span>
<span><span class="co">##     doi = {10.1145/2414416.2414791},</span></span>
<span><span class="co">##   }</span></span></code></pre>
<p>Part of the code (related to event-dependent observation periods) is
based on the SCCS package by Yonas Ghebremichael-Weldeselassie, Heather
Whitaker, and Paddy Farrington.</p>
<p>This work is supported in part through the National Science
Foundation grant IIS 1251151.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martijn Schuemie, Patrick Ryan, Trevor Shaddox, Marc Suchard.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
