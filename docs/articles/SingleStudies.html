<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Single studies using the SelfControlledCaseSeries package • SelfControlledCaseSeries</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Single studies using the SelfControlledCaseSeries package">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SelfControlledCaseSeries</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/MultipleAnalyses.html">Running multiple analyses at once using the SelfControlledCaseSeries package</a>
    </li>
    <li>
      <a href="../articles/SingleStudies.html">Single studies using the SelfControlledCaseSeries package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/OHDSI/SelfControlledCaseSeries">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Single studies using the SelfControlledCaseSeries package</h1>
                        <h4 class="author">Martijn J. Schuemie, Marc A. Suchard and Patrick Ryan</h4>
            
            <h4 class="date">2020-02-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/SelfControlledCaseSeries/blob/master/vignettes/SingleStudies.Rmd"><code>vignettes/SingleStudies.Rmd</code></a></small>
      <div class="hidden name"><code>SingleStudies.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette describes how you can use the <code>SelfControlledCaseSeries</code> package to perform a single Self-Controlled Case Series (SCCS) study. We will walk through all the steps needed to perform an exemplar study, and we have selected the well-studied topic of the effect of NSAIDs on gastrointestinal (GI) bleeding-related hospitalization. For simplicity, we focus on one NSAID: diclofenac.</p>
</div>
<div id="installation-instructions" class="section level1">
<h1 class="hasAnchor">
<a href="#installation-instructions" class="anchor"></a>Installation instructions</h1>
<p>Before installing the <code>SelfControlledCaseSeries</code> package make sure you have Java available. Java can be downloaded from <a href="http://www.java.com">www.java.com</a>. For Windows users, RTools is also necessary. RTools can be downloaded from <a href="http://cran.r-project.org/bin/windows/Rtools/">CRAN</a>.</p>
<p>The <code>SelfControlledCaseSeries</code> package is currently maintained in a <a href="https://github.com/OHDSI/SelfControlledCaseSeries">Github repository</a>, and has dependencies on other packages in Github. All of these packages can be downloaded and installed from within R using the <code>devtools</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(devtools)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">install_github</span>(<span class="st">"ohdsi/ParallelLogger"</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">install_github</span>(<span class="st">"ohdsi/SqlRender"</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">install_github</span>(<span class="st">"ohdsi/DatabaseConnector"</span>)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">install_github</span>(<span class="st">"ohdsi/Cyclops"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="kw">install_github</span>(<span class="st">"ohdsi/SelfControlledCaseSeries"</span>)</span></code></pre></div>
<p>Once installed, you can type <code><a href="https://rdrr.io/r/base/library.html">library(SelfControlledCaseSeries)</a></code> to load the package.</p>
</div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>In the <code>SelfControlledCaseSeries</code> package a study requires at least three steps:</p>
<ol style="list-style-type: decimal">
<li>Loading the necessary data from the database.</li>
<li>Transforming the data into a format suitable for an SCCS study. This step includes the creation of covariates based on the variables extracted from the database, such as defining risk windows based on exposures.</li>
<li>Fitting the model using conditional Poisson regression.</li>
</ol>
<p>In the following sections these steps will be demonstrated for increasingly complex studies.</p>
</div>
<div id="studies-with-a-single-drug" class="section level1">
<h1 class="hasAnchor">
<a href="#studies-with-a-single-drug" class="anchor"></a>Studies with a single drug</h1>
<div id="configuring-the-connection-to-the-server" class="section level2">
<h2 class="hasAnchor">
<a href="#configuring-the-connection-to-the-server" class="anchor"></a>Configuring the connection to the server</h2>
<p>We need to tell R how to connect to the server where the data are. <code>SelfControlledCaseSeries</code> uses the <code>DatabaseConnector</code> package, which provides the <code>createConnectionDetails</code> function. Type <code>?createConnectionDetails</code> for the specific settings required for the various database management systems (DBMS). For example, one might connect to a PostgreSQL database using this code:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>connectionDetails &lt;-<span class="st"> </span><span class="kw">createConnectionDetails</span>(<span class="dt">dbms =</span> <span class="st">"postgresql"</span>, </span>
<span id="cb2-2"><a href="#cb2-2"></a>                                             <span class="dt">server =</span> <span class="st">"localhost/ohdsi"</span>, </span>
<span id="cb2-3"><a href="#cb2-3"></a>                                             <span class="dt">user =</span> <span class="st">"joe"</span>, </span>
<span id="cb2-4"><a href="#cb2-4"></a>                                             <span class="dt">password =</span> <span class="st">"supersecret"</span>)</span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>cdmDatabaseSchema &lt;-<span class="st"> "my_cdm_data"</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>cohortDatabaseSchema &lt;-<span class="st"> "my_results"</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>cdmVersion &lt;-<span class="st"> "5"</span></span></code></pre></div>
<p>The last three lines define the <code>cdmDatabaseSchema</code> and <code>cohortDatabaseSchema</code> variables,as well as the CDM version. We’ll use these later to tell R where the data in CDM format live, where we have stored our cohorts of interest, and what version CDM is used. Note that for Microsoft SQL Server, databaseschemas need to specify both the database and the schema, so for example <code>cdmDatabaseSchema &lt;- "my_cdm_data.dbo"</code>.</p>
</div>
<div id="preparing-the-health-outcome-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#preparing-the-health-outcome-of-interest" class="anchor"></a>Preparing the health outcome of interest</h2>
<p>We need to define the exposures and outcomes for our study. One way to do this is by writing SQL statements against the OMOP CDM that populate a table of events in which we are interested. The resulting table should have the same structure as the <code>cohort</code> table in the CDM. For CDM v5+, this means it should have the fields <code>cohort_definition_id</code>, <code>cohort_start_date</code>, <code>cohort_end_date</code>,and <code>subject_id</code>. For CDM v4, the <code>cohort_definition_id</code> field must be called <code>cohort_concept_id</code>.</p>
<p>For our example study, we have created a file called <em>vignette.sql</em> with the following contents:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1"></a><span class="co">/***********************************</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="co">File vignette.sql </span></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="co">***********************************/</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="cf">IF</span> OBJECT_ID(<span class="st">'@cohortDatabaseSchema.@outcomeTable'</span>, <span class="st">'U'</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw"><a href="https://rdrr.io/r/base/NULL.html">NULL</a></span></span>
<span id="cb3-6"><a href="#cb3-6"></a>  <span class="kw">DROP</span> <span class="kw">TABLE</span> @cohortDatabaseSchema.@outcomeTable;</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="kw">SELECT</span> <span class="dv">1</span> <span class="kw">AS</span> cohort_definition_id,</span>
<span id="cb3-9"><a href="#cb3-9"></a>    condition_start_date <span class="kw">AS</span> cohort_start_date,</span>
<span id="cb3-10"><a href="#cb3-10"></a>    condition_end_date <span class="kw">AS</span> cohort_end_date,</span>
<span id="cb3-11"><a href="#cb3-11"></a>    condition_occurrence.person_id <span class="kw">AS</span> subject_id</span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="kw">INTO</span> @cohortDatabaseSchema.@outcomeTable</span>
<span id="cb3-13"><a href="#cb3-13"></a><span class="kw">FROM</span> @cdmDatabaseSchema.condition_occurrence</span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="kw">INNER</span> <span class="kw">JOIN</span> @cdmDatabaseSchema.visit_occurrence</span>
<span id="cb3-15"><a href="#cb3-15"></a>    <span class="kw">ON</span> condition_occurrence.visit_occurrence_id <span class="op">=</span> visit_occurrence.visit_occurrence_id</span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="kw">WHERE</span> condition_concept_id <span class="kw">IN</span> (</span>
<span id="cb3-17"><a href="#cb3-17"></a>        <span class="kw">SELECT</span> descendant_concept_id</span>
<span id="cb3-18"><a href="#cb3-18"></a>        <span class="kw">FROM</span> @cdmDatabaseSchema.concept_ancestor</span>
<span id="cb3-19"><a href="#cb3-19"></a>        <span class="kw">WHERE</span> ancestor_concept_id <span class="op">=</span> <span class="dv">192671</span> <span class="co">-- GI - Gastrointestinal haemorrhage</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>        )</span>
<span id="cb3-21"><a href="#cb3-21"></a>    <span class="kw">AND</span> visit_occurrence.visit_concept_id <span class="kw">IN</span> (<span class="dv">9201</span>, <span class="dv">9203</span>);</span></code></pre></div>
<p>Note on CDM V4 ‘visit_concept_id’ should be ‘place_of_service_concept_id’, and ‘cohort_definition_id’ should be ‘cohort_concept_id’.</p>
<p>This is parameterized SQL which can be used by the <code>SqlRender</code> package. We use parameterized SQL so we do not have to pre-specify the names of the CDM and cohort schemas. That way, if we want to run the SQL on a different schema, we only need to change the parameter values; we do not have to change the SQL code. By also making use of translation functionality in <code>SqlRender</code>, we can make sure the SQL code can be run in many different environments.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(SqlRender)</span>
<span id="cb4-2"><a href="#cb4-2"></a>sql &lt;-<span class="st"> </span><span class="kw">readSql</span>(<span class="st">"vignette.sql"</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a>sql &lt;-<span class="st"> </span><span class="kw">render</span>(sql,</span>
<span id="cb4-4"><a href="#cb4-4"></a>              <span class="dt">cdmDatabaseSchema =</span> cdmDatabaseSchema, </span>
<span id="cb4-5"><a href="#cb4-5"></a>              <span class="dt">cohortDatabaseSchema =</span> cohortDatabaseSchema</span>
<span id="cb4-6"><a href="#cb4-6"></a>              <span class="dt">outcomeTable =</span> <span class="st">"my_outcomes"</span>)</span>
<span id="cb4-7"><a href="#cb4-7"></a>sql &lt;-<span class="st"> </span><span class="kw">translate</span>(sql, <span class="dt">targetDialect =</span> connectionDetails<span class="op">$</span>dbms)</span>
<span id="cb4-8"><a href="#cb4-8"></a></span>
<span id="cb4-9"><a href="#cb4-9"></a>connection &lt;-<span class="st"> </span><span class="kw">connect</span>(connectionDetails)</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="kw">executeSql</span>(connection, sql)</span></code></pre></div>
<p>In this code, we first read the SQL from the file into memory. In the next line, we replace the three parameter names with the actual values. We then translate the SQL into the dialect appropriate for the DBMS we already specified in the <code>connectionDetails</code>. Next, we connect to the server, and submit the rendered and translated SQL.</p>
<p>If all went well, we now have a table with the outcome of interest. We can see how many events:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>sql &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"SELECT cohort_definition_id, COUNT(*) AS count"</span>,</span>
<span id="cb5-2"><a href="#cb5-2"></a>             <span class="st">"FROM @cohortDatabaseSchema.@outcomeTable"</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>             <span class="st">"GROUP BY cohort_definition_id"</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a>sql &lt;-<span class="st"> </span><span class="kw">render</span>(sql, </span>
<span id="cb5-5"><a href="#cb5-5"></a>              <span class="dt">cohortDatabaseSchema =</span> cohortDatabaseSchema, </span>
<span id="cb5-6"><a href="#cb5-6"></a>              <span class="dt">outcomeTable =</span> <span class="st">"my_outcomes"</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a>sql &lt;-<span class="st"> </span><span class="kw">translate</span>(sql, <span class="dt">targetDialect =</span> connectionDetails<span class="op">$</span>dbms)</span>
<span id="cb5-8"><a href="#cb5-8"></a></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="kw">querySql</span>(connection, sql)</span></code></pre></div>
<pre><code>#&gt;   cohort_concept_id  count
#&gt; 1                 1 635684</code></pre>
</div>
<div id="extracting-the-data-from-the-server" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-the-data-from-the-server" class="anchor"></a>Extracting the data from the server</h2>
<p>Now we can tell <code>SelfControlledCaseSeries</code> to extract all necessary data for our analysis:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>diclofenac &lt;-<span class="st"> </span><span class="dv">1124300</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>sccsData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span>(<span class="dt">connectionDetails =</span> connectionDetails,</span>
<span id="cb7-4"><a href="#cb7-4"></a>                          <span class="dt">cdmDatabaseSchema =</span> cdmDatabaseSchema,</span>
<span id="cb7-5"><a href="#cb7-5"></a>                          <span class="dt">oracleTempSchema =</span> oracleTempSchema,</span>
<span id="cb7-6"><a href="#cb7-6"></a>                          <span class="dt">outcomeDatabaseSchema =</span> cohortDatabaseSchema,</span>
<span id="cb7-7"><a href="#cb7-7"></a>                          <span class="dt">outcomeTable =</span> outcomeTable,</span>
<span id="cb7-8"><a href="#cb7-8"></a>                          <span class="dt">outcomeIds =</span> <span class="dv">1</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>                          <span class="dt">exposureDatabaseSchema =</span> cdmDatabaseSchema,</span>
<span id="cb7-10"><a href="#cb7-10"></a>                          <span class="dt">exposureTable =</span> <span class="st">"drug_era"</span>,</span>
<span id="cb7-11"><a href="#cb7-11"></a>                          <span class="dt">exposureIds =</span> diclofenac,</span>
<span id="cb7-12"><a href="#cb7-12"></a>                          <span class="dt">cdmVersion =</span> cdmVersion)</span>
<span id="cb7-13"><a href="#cb7-13"></a>sccsData</span></code></pre></div>
<pre><code>#&gt; SCCS data object
#&gt; 
#&gt; Exposure concept ID(s): 1124300
#&gt; Outcome concept ID(s): 1</code></pre>
<p>There are many parameters, but they are all documented in the <code>SelfControlledCaseSeries</code> manual. In short, we are pointing the function to the table created earlier and indicating which concept ID in that table identifies the outcome. Note that it is possible to fetch the data for multiple outcomes at once. We further point the function to the <code>drug_era</code> table, and specify the concept ID of our exposure of interest: diclofenac. Again, note that it is also possible to fetch data for multiple drugs at once. In fact, when we do not specify any exposure IDs the function will retrieve the data for all the drugs found in the <code>drug_era</code> table.</p>
<p>All data about the patients, outcomes and exposures are extracted from the server and stored in the <code>sccsData</code> object. This object uses the package <code>ff</code> to store information in a way that ensures R does not run out of memory, even when the data are large.</p>
<p>We can use the generic <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function to view some more information of the data we extracted:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(sccsData)</span></code></pre></div>
<pre><code>#&gt; sccsData object summary
#&gt; 
#&gt; Exposure concept ID(s): 1124300
#&gt; Outcome concept ID(s): 1
#&gt; 
#&gt; Cases: 304906
#&gt; 
#&gt; Outcome counts:
#&gt;   Event count Case count
#&gt; 1      635684     304906
#&gt; 
#&gt; Covariates:
#&gt; Number of covariates: 1
#&gt; Number of covariate eras: 32227</code></pre>
<div id="saving-the-data-to-file" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-the-data-to-file" class="anchor"></a>Saving the data to file</h3>
<p>Creating the <code>sccsData</code> file can take considerable computing time, and it is probably a good idea to save it for future sessions. Because <code>sccsData</code> uses <code>ff</code>, we cannot use R’s regular save function. Instead, we’ll have to use the <code><a href="../reference/saveSccsData.html">saveSccsData()</a></code> function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw"><a href="../reference/saveSccsData.html">saveSccsData</a></span>(sccsData, <span class="st">"diclofenacAndGiBleed"</span>)</span></code></pre></div>
<p>We can use the <code><a href="../reference/loadSccsData.html">loadSccsData()</a></code> function to load the data in a future session.</p>
</div>
</div>
<div id="defining-a-simple-model" class="section level2">
<h2 class="hasAnchor">
<a href="#defining-a-simple-model" class="anchor"></a>Defining a simple model</h2>
<p>Next, we can use the data to specify a simple model to fit:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>covarDiclofenac =<span class="st"> </span><span class="kw"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span>(<span class="dt">label =</span> <span class="st">"Exposure of interest"</span>,</span>
<span id="cb12-2"><a href="#cb12-2"></a>                                          <span class="dt">includeCovariateIds =</span> diclofenac,</span>
<span id="cb12-3"><a href="#cb12-3"></a>                                          <span class="dt">start =</span> <span class="dv">0</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>                                          <span class="dt">end =</span> <span class="dv">0</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>                                          <span class="dt">addExposedDaysToEnd =</span> <span class="ot">TRUE</span>)</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a>sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb12-8"><a href="#cb12-8"></a>                                 <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb12-9"><a href="#cb12-9"></a>                                 <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb12-10"><a href="#cb12-10"></a>                                 <span class="dt">covariateSettings =</span> covarDiclofenac)</span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(sccsEraData)</span></code></pre></div>
<pre><code>#&gt; sccsEraData object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1       34101      15262
#&gt; 
#&gt; Covariates:
#&gt; Number of covariates: 1
#&gt; Number of covariate eras: 15262
#&gt; 
#&gt;                                  Original covariate ID Current covariate ID
#&gt; Exposure of interest: Diclofenac               1124300                 1000</code></pre>
<p>In this example, we use the <code>createCovariateSettings</code> to define a single covariate: exposure to diclofenac. We specify that the risk window is from start of exposure to the end by setting start and end to 0, and requiring that the length of exposure is added to the end date.</p>
<p>We then use the covariate definition in the <code>createSccsEraData</code>, and also specify that the first 180 days of observation of every person, the so-called ‘naive period’, will be excluded from the analysis. Note that data in the naive period will be used to determine exposure status at the start of follow-up (after the end of the naive period). We also specify we will use all occurrences of the outcome, not just the first one per person.</p>
</div>
<div id="power-calculations" class="section level2">
<h2 class="hasAnchor">
<a href="#power-calculations" class="anchor"></a>Power calculations</h2>
<p>Before we start fitting an outcome model, we might be interested to know whether we have sufficient power to detect a particular effect size. It makes sense to perform these power calculations once the study population has been fully defined, so taking into account loss to the various inclusion and exclusion criteria. This means we will use the sccsEraData object we’ve just created as the basis for our power calculations. Since the sample size is fixed in retrospective studies (the data has already been collected), and the true effect size is unknown, the SelfControlledCaseSeries package provides a function to compute the minimum detectable relative risk (MDRR) instead:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="kw"><a href="../reference/computeMdrr.html">computeMdrr</a></span>(sccsEraData, <span class="dt">exposureCovariateId =</span> <span class="dv">1000</span>, <span class="dt">alpha =</span> <span class="fl">0.05</span>, <span class="dt">power =</span> <span class="fl">0.8</span>, <span class="dt">twoSided =</span> <span class="ot">TRUE</span>, </span>
<span id="cb14-2"><a href="#cb14-2"></a>    <span class="dt">method =</span> <span class="st">"binomial"</span>)</span></code></pre></div>
<pre><code>#&gt;   timeExposed timeTotal propTimeExposed propPopExposued events   mdrr
#&gt; 1     1661649  30008800          0.0554               1  34101 1.0676</code></pre>
<p>Note that we have to provide the covariate ID of the exposure of interest, which we learned by calling <code>summary</code> on sccsEraData earlier. This is because we may have many covariates in our model, but will likely only be interested in the MDRR of one.</p>
</div>
<div id="model-fitting" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting" class="anchor"></a>Model fitting</h2>
<p>The <code>fitSccsModel</code> function is used to fit the model:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span>(sccsEraData)</span></code></pre></div>
<p>We can inspect the resulting model:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; sccsModel object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1       34101      15262
#&gt; 
#&gt; Estimates:
#&gt;                               Name    ID  Estimate  lower .95  upper .95
#&gt;   Exposure of interest: Diclofenac  1000     1.291      1.236      1.349
#&gt;    logRr  seLogRr
#&gt;   0.2556  0.02238</code></pre>
<p>This tells us what the estimated relative risk (the incidence rate ratio) is during exposure to diclofenac compared to non-exposed time. Note that we lost some cases due to imposing the 180 day naive period.</p>
</div>
<div id="adding-a-pre-exposure-window" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-pre-exposure-window" class="anchor"></a>Adding a pre-exposure window</h2>
<p>The fact that NSAIDs like diclofenac can cause GI bleeds is well known to doctors, and this knowledge affects prescribing behavior. For example, a patient who has just had a GI bleed is not likely to be prescribed diclofenac. This may lead to underestimation of the rate during unexposed time, because the unexposed time includes time just prior to exposure where observing of the outcome is unlikely because of this behavior. One solution to this problem that is often used is to introduce a separate ‘risk window’ just prior to exposure, to separate it from the remaining unexposed time. We can add such a ‘pre-exposure window’ to our analysis:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>  covarPreDiclofenac =<span class="st"> </span><span class="kw"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span>(<span class="dt">label =</span> <span class="st">"Pre-exposure"</span>,</span>
<span id="cb19-2"><a href="#cb19-2"></a>                                               <span class="dt">includeCovariateIds =</span> diclofenac,</span>
<span id="cb19-3"><a href="#cb19-3"></a>                                               <span class="dt">start =</span> <span class="dv">-60</span>,</span>
<span id="cb19-4"><a href="#cb19-4"></a>                                               <span class="dt">end =</span> <span class="dv">-1</span>)</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>  sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb19-7"><a href="#cb19-7"></a>                                   <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb19-8"><a href="#cb19-8"></a>                                   <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb19-9"><a href="#cb19-9"></a>                                   <span class="dt">covariateSettings =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(covarDiclofenac,</span>
<span id="cb19-10"><a href="#cb19-10"></a>                                                            covarPreDiclofenac))</span>
<span id="cb19-11"><a href="#cb19-11"></a></span>
<span id="cb19-12"><a href="#cb19-12"></a>  model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span>(sccsEraData)</span></code></pre></div>
<p>Here we created a new covariate definition in addition to the first one. We define the risk window to start 60 days prior to exposure, and end on the day just prior to exposure. We combine the two covariate settings in a list for the <code>createSccsEraData</code> function. Again, we can take a look at the results:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; sccsModel object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1       34101      15262
#&gt; 
#&gt; Estimates:
#&gt;                               Name    ID  Estimate  lower .95  upper .95
#&gt;   Exposure of interest: Diclofenac  1000    1.2865     1.2306      1.344
#&gt;           Pre-exposure: Diclofenac  1001    0.9624     0.9189      1.007
#&gt;      logRr  seLogRr
#&gt;    0.25195  0.02255
#&gt;   -0.03831  0.02346</code></pre>
<p>Here we indeed see a lower relative risk in the time preceding the exposure, indicating the outcome might be a contra-indication for the drug of interest.</p>
</div>
<div id="splitting-risk-windows" class="section level2">
<h2 class="hasAnchor">
<a href="#splitting-risk-windows" class="anchor"></a>Splitting risk windows</h2>
<p>Often we will want to split the risk windows into smaller parts and compute estimates for each part. This can give us insight into the temporal distribution of the risk. We can add this to the model:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>  covarDiclofenacSplit =<span class="st"> </span><span class="kw"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span>(<span class="dt">label =</span> <span class="st">"Exposure of interest"</span>,</span>
<span id="cb22-2"><a href="#cb22-2"></a>                                                 <span class="dt">includeCovariateIds =</span> diclofenac,</span>
<span id="cb22-3"><a href="#cb22-3"></a>                                                 <span class="dt">start =</span> <span class="dv">0</span>,</span>
<span id="cb22-4"><a href="#cb22-4"></a>                                                 <span class="dt">end =</span> <span class="dv">0</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>                                                 <span class="dt">addExposedDaysToEnd =</span> <span class="ot">TRUE</span>,</span>
<span id="cb22-6"><a href="#cb22-6"></a>                                                 <span class="dt">splitPoints =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">7</span>,<span class="dv">14</span>))</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a>  covarPreDiclofenacSplit =<span class="st"> </span><span class="kw"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span>(<span class="dt">label =</span> <span class="st">"Pre-exposure"</span>,</span>
<span id="cb22-9"><a href="#cb22-9"></a>                                                    <span class="dt">includeCovariateIds =</span> diclofenac,</span>
<span id="cb22-10"><a href="#cb22-10"></a>                                                    <span class="dt">start =</span> <span class="dv">-60</span>,</span>
<span id="cb22-11"><a href="#cb22-11"></a>                                                    <span class="dt">end =</span> <span class="dv">-1</span>,</span>
<span id="cb22-12"><a href="#cb22-12"></a>                                                    <span class="dt">splitPoints =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">30</span>))</span>
<span id="cb22-13"><a href="#cb22-13"></a></span>
<span id="cb22-14"><a href="#cb22-14"></a>  sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb22-15"><a href="#cb22-15"></a>                                   <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb22-16"><a href="#cb22-16"></a>                                   <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb22-17"><a href="#cb22-17"></a>                                   <span class="dt">covariateSettings =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(covarDiclofenacSplit,</span>
<span id="cb22-18"><a href="#cb22-18"></a>                                                            covarPreDiclofenacSplit))</span></code></pre></div>
<p>Here we’ve redefined out covariate definitions: We kept the same start and end dates, but enforced split points for the main exposure windows at 7 and 14 days. For the pre-exposure window we divided the window into two, at day 30 before the exposure start. Note that the split point dates indicate the end date of the preceding part, so the exposure is now split into day 0 to (and including) day 7, day 8 to (and including) day 14, and day 15 until the end of exposure. The results are:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; sccsModel object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1       34101      15262
#&gt; 
#&gt; Estimates:
#&gt;                                         Name    ID  Estimate  lower .95
#&gt;    Exposure of interest: Diclofenac, day 0-7  1000    1.3101     1.1828
#&gt;   Exposure of interest: Diclofenac, day 8-14  1001    1.3839     1.2346
#&gt;    Exposure of interest: Diclofenac, day 15-  1002    1.2569     1.1940
#&gt;        Pre-exposure: Diclofenac, day -60--30  1003    1.0505     0.9893
#&gt;           Pre-exposure: Diclofenac, day -29-  1004    0.8797     0.8228
#&gt;   upper .95     logRr  seLogRr
#&gt;      1.4470   0.27014  0.05143
#&gt;      1.5450   0.32488  0.05722
#&gt;      1.3225   0.22865  0.02608
#&gt;      1.1143   0.04924  0.03036
#&gt;      0.9393  -0.12816  0.03377</code></pre>
<p>We see that the risk for the three exposure windows is more or less the same, suggesting a constant risk. We also see that the period 60 to 30 days prior to exposure does not seem to show a decreased risk, suggesting the effect of the contra-indication does not extend more than 30 days before the exposure.</p>
</div>
<div id="including-age-and-seasonality" class="section level2">
<h2 class="hasAnchor">
<a href="#including-age-and-seasonality" class="anchor"></a>Including age and seasonality</h2>
<p>Often both the rate of exposure and the outcome change with age, and can even depend on the season. This may lead to confounding and may bias our estimates. To correct for this we can include age and/or season into the model.</p>
<p>For computational reasons we assume the effect of both age and season are constant within each calendar month. We assume that the rate from one month to the next can be different, but we also assume that subsequent months have somewhat similar rates. This is implemented by using cubic spline functions.</p>
<p><img src="spline.png" alt="Spline for seasonality"><em>Figure 1</em>. Example of how a spline is used for seasonality: within a month, the risk attributable to seasonality is assumed to be constant, but from month to month the risks are assumed to follow a cyclic cubic spline.</p>
<p>Note that the by default all people that have the outcome will be used to estimate the effect of age and seasonality on the outcome, so not just the people exposed to the drug of interest. We can add age and seasonality like this:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>ageSettings &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createAgeSettings.html">createAgeSettings</a></span>(<span class="dt">includeAge =</span> <span class="ot">TRUE</span>,</span>
<span id="cb25-2"><a href="#cb25-2"></a>                                 <span class="dt">ageKnots =</span> <span class="dv">5</span>)</span>
<span id="cb25-3"><a href="#cb25-3"></a>  </span>
<span id="cb25-4"><a href="#cb25-4"></a>seasonalitySettings &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSeasonalitySettings.html">createSeasonalitySettings</a></span>(<span class="dt">includeSeasonality =</span> <span class="ot">TRUE</span>,</span>
<span id="cb25-5"><a href="#cb25-5"></a>                                                 <span class="dt">seasonKnots =</span> <span class="dv">5</span>)</span>
<span id="cb25-6"><a href="#cb25-6"></a>  </span>
<span id="cb25-7"><a href="#cb25-7"></a>sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb25-8"><a href="#cb25-8"></a>                                 <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb25-9"><a href="#cb25-9"></a>                                 <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb25-10"><a href="#cb25-10"></a>                                 <span class="dt">covariateSettings =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(covarDiclofenacSplit,</span>
<span id="cb25-11"><a href="#cb25-11"></a>                                                          covarPreDiclofenacSplit),</span>
<span id="cb25-12"><a href="#cb25-12"></a>                                 <span class="dt">ageSettings =</span> ageSettings,</span>
<span id="cb25-13"><a href="#cb25-13"></a>                                 <span class="dt">seasonalitySettings =</span> seasonalitySettings)</span>
<span id="cb25-14"><a href="#cb25-14"></a>  </span>
<span id="cb25-15"><a href="#cb25-15"></a>model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span>(sccsEraData)</span></code></pre></div>
<p>Again, we can inspect the model:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; sccsModel object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1      477652     221883
#&gt; 
#&gt; Estimates:
#&gt;                                         Name    ID  Estimate  lower .95
#&gt;                       Age spline component 1   100    2.3080     1.9211
#&gt;                       Age spline component 2   101    5.4204     4.6248
#&gt;                       Age spline component 3   102   23.5825    19.7502
#&gt;                       Age spline component 4   103  138.7980   115.3770
#&gt;                       Age spline component 5   104  567.8032   473.2041
#&gt;               Seasonality spline component 1   200    0.9335     0.9109
#&gt;               Seasonality spline component 2   201    1.2590     1.2427
#&gt;               Seasonality spline component 3   202    1.0833     1.0555
#&gt;    Exposure of interest: Diclofenac, day 0-7  1000    1.3075     1.1803
#&gt;   Exposure of interest: Diclofenac, day 8-14  1001    1.3824     1.2333
#&gt;    Exposure of interest: Diclofenac, day 15-  1002    1.2563     1.1933
#&gt;        Pre-exposure: Diclofenac, day -60--30  1003    1.0503     0.9892
#&gt;           Pre-exposure: Diclofenac, day -29-  1004    0.8783     0.8216
#&gt;   upper .95     logRr   seLogRr
#&gt;      2.7734   0.83639  0.093667
#&gt;      6.3541   1.69017  0.081040
#&gt;     28.1638   3.16050  0.090530
#&gt;    167.0090   4.93302  0.094349
#&gt;    681.4509   6.34177  0.093037
#&gt;      0.9566  -0.06881  0.012485
#&gt;      1.2754   0.23028  0.006613
#&gt;      1.1118   0.08001  0.013266
#&gt;      1.4441   0.26810  0.051459
#&gt;      1.5434   0.32385  0.057220
#&gt;      1.3219   0.22816  0.026108
#&gt;      1.1142   0.04910  0.030365
#&gt;      0.9379  -0.12971  0.033774</code></pre>
<p>We see that our estimates for exposed and pre-exposure time have not changes much. We can plot the spline curves for age and season to learn more:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="kw"><a href="../reference/plotAgeEffect.html">plotAgeEffect</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; Warning: Removed 14 rows containing missing values (geom_path).</code></pre>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw"><a href="../reference/plotSeasonality.html">plotSeasonality</a></span>(model)</span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-32-1.png" width="700"></p>
<p>We see a strong effect for age on the outcome, but this effect is spread out over many years and so it less likely to affect the estimates for any individual, since most people are only observed for a few years in the database. We do not see a strong effect for season.</p>
</div>
<div id="considering-event-dependent-observation-time" class="section level2">
<h2 class="hasAnchor">
<a href="#considering-event-dependent-observation-time" class="anchor"></a>Considering event-dependent observation time</h2>
<p>The SCCS method requires that observation periods are independent of outcome times. This requirement is violated when outcomes increase the mortality rate, since censoring of the observation periods is then event-dependent. A modification to the SCCS has been proposed that attempts to correct for this. First, several models are fitted to estimate the amount and shape of the event-dependent censoring, and the best fitting model is selected. Next, this model is used to reweigh various parts of the observation time. This approach is also implemented in this package, and can be turned on using the <code>eventDependentObservation</code> argument of the <code>createSccsEraData</code> function:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb31-2"><a href="#cb31-2"></a>                                 <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb31-3"><a href="#cb31-3"></a>                                 <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb31-4"><a href="#cb31-4"></a>                                 <span class="dt">covariateSettings =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(covarDiclofenacSplit,</span>
<span id="cb31-5"><a href="#cb31-5"></a>                                                          covarPreDiclofenacSplit),</span>
<span id="cb31-6"><a href="#cb31-6"></a>                                 <span class="dt">ageSettings =</span> ageSettings,</span>
<span id="cb31-7"><a href="#cb31-7"></a>                                 <span class="dt">seasonalitySettings =</span> seasonalitySettings,</span>
<span id="cb31-8"><a href="#cb31-8"></a>                                 <span class="dt">eventDependentObservation =</span> <span class="ot">TRUE</span>)</span>
<span id="cb31-9"><a href="#cb31-9"></a></span>
<span id="cb31-10"><a href="#cb31-10"></a>model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span>(sccsEraData)</span></code></pre></div>
<p>Again, we can inspect the model:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; sccsModel object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1      477652     221883
#&gt; 
#&gt; Estimates:
#&gt;                                         Name    ID       Estimate     lower .95
#&gt;                       Age spline component 1   100  0.00144182841  0.0011994346
#&gt;                       Age spline component 2   101  0.00001338050  0.0000114179
#&gt;                       Age spline component 3   102  0.00000047041  0.0000003938
#&gt;                       Age spline component 4   103  0.00000013375  0.0000001112
#&gt;                       Age spline component 5   104  0.00000006638  0.0000000553
#&gt;               Seasonality spline component 1   200  0.93393312697  0.9113429890
#&gt;               Seasonality spline component 2   201  1.26203707132  1.2457895980
#&gt;               Seasonality spline component 3   202  1.08377465617  1.0559583046
#&gt;    Exposure of interest: Diclofenac, day 0-7  1000  1.30672447217  1.1796344074
#&gt;   Exposure of interest: Diclofenac, day 8-14  1001  1.38117721934  1.2322138384
#&gt;    Exposure of interest: Diclofenac, day 15-  1002  1.25599408549  1.1930389639
#&gt;        Pre-exposure: Diclofenac, day -60--30  1003  1.04934811388  0.9882584365
#&gt;           Pre-exposure: Diclofenac, day -29-  1004  0.87762735714  0.8208905194
#&gt;       upper .95      logRr   seLogRr
#&gt;   0.00173296015   -6.54184  0.093874
#&gt;   0.00001567801  -11.22171  0.080888
#&gt;   0.00000056177  -14.56966  0.090597
#&gt;   0.00000016092  -15.82728  0.094385
#&gt;   0.00000007966  -16.52794  0.093129
#&gt;   0.95708699447   -0.06835  0.012494
#&gt;   1.27849492265    0.23273  0.006611
#&gt;   1.11232490830    0.08045  0.013266
#&gt;   1.44331308108    0.26752  0.051464
#&gt;   1.54203332742    0.32294  0.057218
#&gt;   1.32160792743    0.22793  0.026109
#&gt;   1.11312293384    0.04817  0.030353
#&gt;   0.93707786113   -0.13053  0.033770</code></pre>
</div>
</div>
<div id="studies-with-more-than-one-drug" class="section level1">
<h1 class="hasAnchor">
<a href="#studies-with-more-than-one-drug" class="anchor"></a>Studies with more than one drug</h1>
<p>Although we are usually interested in the effect of a single drug or drug class, it could be beneficial to add exposure to other drugs to the analysis if we believe those drugs represent time-varying confounders that we wish to correct for.</p>
<div id="adding-a-class-of-drugs" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-class-of-drugs" class="anchor"></a>Adding a class of drugs</h2>
<p>For example, oftentimes diclofenac is co-prescribed with proton-pump inhibitors (PPIs) to mitigate the risk of GI bleeding. We would like our estimate to represent just the effect of the diclofenac, so we need to keep the effect of the PPIs separate. First we have to retrieve the information on PPI exposure from the database:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>diclofenac &lt;-<span class="st"> </span><span class="dv">1124300</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>ppis &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">911735</span>, <span class="dv">929887</span>, <span class="dv">923645</span>, <span class="dv">904453</span>, <span class="dv">948078</span>, <span class="dv">19039926</span>)</span>
<span id="cb34-3"><a href="#cb34-3"></a></span>
<span id="cb34-4"><a href="#cb34-4"></a>sccsData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span>(<span class="dt">connectionDetails =</span> connectionDetails,</span>
<span id="cb34-5"><a href="#cb34-5"></a>                          <span class="dt">cdmDatabaseSchema =</span> cdmDatabaseSchema,</span>
<span id="cb34-6"><a href="#cb34-6"></a>                          <span class="dt">oracleTempSchema =</span> oracleTempSchema,</span>
<span id="cb34-7"><a href="#cb34-7"></a>                          <span class="dt">outcomeDatabaseSchema =</span> cohortDatabaseSchema,</span>
<span id="cb34-8"><a href="#cb34-8"></a>                          <span class="dt">outcomeTable =</span> outcomeTable,</span>
<span id="cb34-9"><a href="#cb34-9"></a>                          <span class="dt">outcomeIds =</span> <span class="dv">1</span>,</span>
<span id="cb34-10"><a href="#cb34-10"></a>                          <span class="dt">exposureDatabaseSchema =</span> cdmDatabaseSchema,</span>
<span id="cb34-11"><a href="#cb34-11"></a>                          <span class="dt">exposureTable =</span> <span class="st">"drug_era"</span>,</span>
<span id="cb34-12"><a href="#cb34-12"></a>                          <span class="dt">exposureIds =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(diclofenac, ppis),</span>
<span id="cb34-13"><a href="#cb34-13"></a>                          <span class="dt">cdmVersion =</span> cdmVersion)</span>
<span id="cb34-14"><a href="#cb34-14"></a>sccsData</span></code></pre></div>
<pre><code>#&gt; SCCS data object
#&gt; 
#&gt; Exposure concept ID(s): 1124300,911735,929887,923645,904453,948078,19039926
#&gt; Outcome concept ID(s): 1</code></pre>
<p>Once retrieved, we can use the data to build and fit our model:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>covarPpis =<span class="st"> </span><span class="kw"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span>(<span class="dt">label =</span> <span class="st">"PPIs"</span>,</span>
<span id="cb36-2"><a href="#cb36-2"></a>                                    <span class="dt">includeCovariateIds =</span> ppis,</span>
<span id="cb36-3"><a href="#cb36-3"></a>                                    <span class="dt">stratifyById =</span> <span class="ot">FALSE</span>,</span>
<span id="cb36-4"><a href="#cb36-4"></a>                                    <span class="dt">start =</span> <span class="dv">1</span>,</span>
<span id="cb36-5"><a href="#cb36-5"></a>                                    <span class="dt">end =</span> <span class="dv">0</span>,</span>
<span id="cb36-6"><a href="#cb36-6"></a>                                    <span class="dt">addExposedDaysToEnd =</span> <span class="ot">TRUE</span>)</span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a>sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb36-9"><a href="#cb36-9"></a>                                 <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb36-10"><a href="#cb36-10"></a>                                 <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb36-11"><a href="#cb36-11"></a>                                 <span class="dt">covariateSettings =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(covarDiclofenacSplit,</span>
<span id="cb36-12"><a href="#cb36-12"></a>                                                          covarPreDiclofenacSplit,</span>
<span id="cb36-13"><a href="#cb36-13"></a>                                                          covarPpis),</span>
<span id="cb36-14"><a href="#cb36-14"></a>                                 <span class="dt">ageSettings =</span> ageSettings,</span>
<span id="cb36-15"><a href="#cb36-15"></a>                                 <span class="dt">seasonalitySettings =</span> seasonalitySettings,</span>
<span id="cb36-16"><a href="#cb36-16"></a>                                 <span class="dt">eventDependentObservation =</span> <span class="ot">TRUE</span>)</span>
<span id="cb36-17"><a href="#cb36-17"></a></span>
<span id="cb36-18"><a href="#cb36-18"></a>model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span>(sccsEraData)</span></code></pre></div>
<p>Here, we added a new covariate based on the list of concept IDs for the various PPIs. In this example we set <code>stratifyById</code> to FALSE, meaning that we will estimate a single incidence rate ratio for all PPIs, so one estimate for the entire class of drugs. Note that duplicates will be removed: if a person is exposed to two PPIs on the same day, this will be counted only once when fitting the model. Furthermore, we have set the <code>start</code> day to 1 instead of 0. The reason for this is that PPIs will also be used to treat GI bleeds, and are likely to be prescribed on the same day as the event. If we would include day 0, the risk of the outcome would be attributed to the PPI used for treatment, not the other factors that caused the GI bleed such as any exposure to our drug of interest. Again, we can inspect the model:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(model)</span></code></pre></div>
<pre><code>#&gt; sccsModel object summary
#&gt; 
#&gt; Outcome ID: 1
#&gt; 
#&gt; Outcome count:
#&gt;   Event count Case count
#&gt; 1      477656     221884
#&gt; 
#&gt; Estimates:
#&gt;                                         Name    ID       Estimate
#&gt;                       Age spline component 1   100  0.00148267108
#&gt;                       Age spline component 2   101  0.00001451524
#&gt;                       Age spline component 3   102  0.00000051986
#&gt;                       Age spline component 4   103  0.00000014701
#&gt;                       Age spline component 5   104  0.00000007313
#&gt;               Seasonality spline component 1   200  0.93248483577
#&gt;               Seasonality spline component 2   201  1.26264480643
#&gt;               Seasonality spline component 3   202  1.08299048177
#&gt;    Exposure of interest: Diclofenac, day 0-7  1000  1.31746486297
#&gt;   Exposure of interest: Diclofenac, day 8-14  1001  1.39395384538
#&gt;    Exposure of interest: Diclofenac, day 15-  1002  1.27228249951
#&gt;        Pre-exposure: Diclofenac, day -60--30  1003  1.05239240243
#&gt;           Pre-exposure: Diclofenac, day -29-  1004  0.88178136355
#&gt;                                         PPIs  1005  0.86949649231
#&gt;       lower .95      upper .95      logRr   seLogRr
#&gt;   0.00123348791  0.00178196006   -6.51391  0.093846
#&gt;   0.00001238511  0.00001700929  -11.14031  0.080936
#&gt;   0.00000043518  0.00000062092  -14.46971  0.090678
#&gt;   0.00000012216  0.00000017689  -15.73275  0.094445
#&gt;   0.00000006091  0.00000008778  -16.43107  0.093197
#&gt;   0.90998675144  0.95554302671   -0.06990  0.012462
#&gt;   1.24638982714  1.27911025241    0.23321  0.006611
#&gt;   1.05519525236  1.11151903260    0.07973  0.013266
#&gt;   1.18892816556  1.45490394068    0.27571  0.051503
#&gt;   1.24359731631  1.55633675881    0.33214  0.057227
#&gt;   1.20801129404  1.33928887162    0.24081  0.026318
#&gt;   0.99105910656  1.11645870362    0.05107  0.030394
#&gt;   0.82475484633  0.94154240972   -0.12581  0.033785
#&gt;   0.85884359717  0.88026751799   -0.13984  0.006286</code></pre>
<p>We do see a decrease in risk when people are exposed to PPIs.</p>
</div>
<div id="adding-all-drugs" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-all-drugs" class="anchor"></a>Adding all drugs</h2>
<p>Another approach could be to add all drugs into the model. Again, the first step is to get all the relevant data from the database:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>sccsData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getDbSccsData.html">getDbSccsData</a></span>(<span class="dt">connectionDetails =</span> connectionDetails,</span>
<span id="cb39-2"><a href="#cb39-2"></a>                          <span class="dt">cdmDatabaseSchema =</span> cdmDatabaseSchema,</span>
<span id="cb39-3"><a href="#cb39-3"></a>                          <span class="dt">oracleTempSchema =</span> oracleTempSchema,</span>
<span id="cb39-4"><a href="#cb39-4"></a>                          <span class="dt">outcomeDatabaseSchema =</span> cohortDatabaseSchema,</span>
<span id="cb39-5"><a href="#cb39-5"></a>                          <span class="dt">outcomeTable =</span> outcomeTable,</span>
<span id="cb39-6"><a href="#cb39-6"></a>                          <span class="dt">outcomeIds =</span> <span class="dv">1</span>,</span>
<span id="cb39-7"><a href="#cb39-7"></a>                          <span class="dt">exposureDatabaseSchema =</span> cdmDatabaseSchema,</span>
<span id="cb39-8"><a href="#cb39-8"></a>                          <span class="dt">exposureTable =</span> <span class="st">"drug_era"</span>,</span>
<span id="cb39-9"><a href="#cb39-9"></a>                          <span class="dt">exposureIds =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(),</span>
<span id="cb39-10"><a href="#cb39-10"></a>                          <span class="dt">cdmVersion =</span> cdmVersion)</span></code></pre></div>
<p>Note that the <code>exposureIds</code> argument is left empty. This will cause data for all concepts in the exposure table to be retrieved. Next, we simply create a new set of covariates, and fit the model:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>covarAllDrugs =<span class="st"> </span><span class="kw"><a href="../reference/createCovariateSettings.html">createCovariateSettings</a></span>(<span class="dt">label =</span> <span class="st">"All other exposures"</span>,</span>
<span id="cb40-2"><a href="#cb40-2"></a>                                        <span class="dt">excludeCovariateIds =</span> diclofenac,</span>
<span id="cb40-3"><a href="#cb40-3"></a>                                        <span class="dt">stratifyById =</span> <span class="ot">TRUE</span>,</span>
<span id="cb40-4"><a href="#cb40-4"></a>                                        <span class="dt">start =</span> <span class="dv">1</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>                                        <span class="dt">end =</span> <span class="dv">0</span>,</span>
<span id="cb40-6"><a href="#cb40-6"></a>                                        <span class="dt">addExposedDaysToEnd =</span> <span class="ot">TRUE</span>,</span>
<span id="cb40-7"><a href="#cb40-7"></a>                                        <span class="dt">allowRegularization =</span> <span class="ot">TRUE</span>)</span>
<span id="cb40-8"><a href="#cb40-8"></a></span>
<span id="cb40-9"><a href="#cb40-9"></a>sccsEraData &lt;-<span class="st"> </span><span class="kw"><a href="../reference/createSccsEraData.html">createSccsEraData</a></span>(sccsData,</span>
<span id="cb40-10"><a href="#cb40-10"></a>                                 <span class="dt">naivePeriod =</span> <span class="dv">180</span>,</span>
<span id="cb40-11"><a href="#cb40-11"></a>                                 <span class="dt">firstOutcomeOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb40-12"><a href="#cb40-12"></a>                                 <span class="dt">covariateSettings =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(covarDiclofenacSplit,</span>
<span id="cb40-13"><a href="#cb40-13"></a>                                                          covarPreDiclofenacSplit,</span>
<span id="cb40-14"><a href="#cb40-14"></a>                                                          covarAllDrugs),</span>
<span id="cb40-15"><a href="#cb40-15"></a>                                 <span class="dt">ageSettings =</span> ageSettings,</span>
<span id="cb40-16"><a href="#cb40-16"></a>                                 <span class="dt">seasonalitySettings =</span> seasonalitySettings,</span>
<span id="cb40-17"><a href="#cb40-17"></a>                                 <span class="dt">eventDependentObservation =</span> <span class="ot">TRUE</span>)</span>
<span id="cb40-18"><a href="#cb40-18"></a></span>
<span id="cb40-19"><a href="#cb40-19"></a>model &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fitSccsModel.html">fitSccsModel</a></span>(sccsEraData)</span></code></pre></div>
<p>The first thing to note is that we have defined the new covariates to be all drugs except diclofenac by not specifying the <code>includeCovariateIds</code> and setting the <code>excludeCovariateIds</code> to the concept ID of diclofenac. Furthermore, we have specified that <code>stratifyById</code> is TRUE, meaning an estimate will be produced for each drug.</p>
<p>We have set <code>allowRegularization</code> to TRUE, meaning we will use regularization for all estimates in this new covariate set. Regularization means we will impose a prior distribution on the effect size, effectually penalizing large estimates. This helps fit the model, for example when some drugs are rare, and when drugs are almost often prescribed together and their individual effects are difficult to untangle.</p>
<p>Because there are now so many estimates, we will not use the <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> function but instead export all estimates to a data frame using <code><a href="../reference/getModel.html">getModel()</a></code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>estimates &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getModel.html">getModel</a></span>(model)</span>
<span id="cb41-2"><a href="#cb41-2"></a>estimates[estimates<span class="op">$</span>originalCovariateId <span class="op">==</span><span class="st"> </span>diclofenac, ]</span></code></pre></div>
<pre><code>#&gt;                                          name   id  estimate    lb95Ci
#&gt; 9   Exposure of interest: Diclofenac, day 0-7 1000 1.2186165 1.0998782
#&gt; 10 Exposure of interest: Diclofenac, day 8-14 1001 1.3125335 1.1707281
#&gt; 11  Exposure of interest: Diclofenac, day 15- 1002 1.2029109 1.1413948
#&gt; 12      Pre-exposure: Diclofenac, day -60--30 1003 1.0281745 0.9682846
#&gt; 13         Pre-exposure: Diclofenac, day -29- 1004 0.8492762 0.7941782
#&gt;       ub95Ci       logRr    seLogRr originalCovariateId originalCovariateName
#&gt; 9  1.3458385  0.19771621 0.05148507             1124300            Diclofenac
#&gt; 10 1.4656947  0.27195923 0.05732336             1124300            Diclofenac
#&gt; 11 1.2666515  0.18474438 0.02656319             1124300            Diclofenac
#&gt; 12 1.0906634  0.02778491 0.03036163             1124300            Diclofenac
#&gt; 13 0.9069971 -0.16337086 0.03388618             1124300            Diclofenac</code></pre>
<p>Here we see that despite the extensive adjustments that are made in the model, the effect estimates for diclofenac have remained nearly the same.</p>
<p>In case we’re interested, we can also look at the effect sizes for the PPIs:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>estimates[estimates<span class="op">$</span>originalCovariateId <span class="op">%in%</span><span class="st"> </span>ppis, ]</span></code></pre></div>
<pre><code>#&gt;                                 name   id  estimate lb95Ci ub95Ci      logRr
#&gt; 89     Other exposures: Esomeprazole 1151 0.7068353     NA     NA -0.3469576
#&gt; 96      Other exposures: rabeprazole 1174 0.8532116     NA     NA -0.1587477
#&gt; 113      Other exposures: Omeprazole 1207 0.8018277     NA     NA -0.2208615
#&gt; 120    Other exposures: lansoprazole 1224 0.8678528     NA     NA -0.1417331
#&gt; 141    Other exposures: pantoprazole 1261 0.7008323     NA     NA -0.3554867
#&gt; 446 Other exposures: dexlansoprazole 1858 0.6608101     NA     NA -0.4142887
#&gt;     seLogRr originalCovariateId originalCovariateName
#&gt; 89       NA              904453          Esomeprazole
#&gt; 96       NA              911735           rabeprazole
#&gt; 113      NA              923645            Omeprazole
#&gt; 120      NA              929887          lansoprazole
#&gt; 141      NA              948078          pantoprazole
#&gt; 446      NA            19039926       dexlansoprazole</code></pre>
<p>Note that because we used regularization, we are not able to compute the confidence intervals for these estimates. We do again see that PPIs all have relative risks lower than 1 as we would expect.</p>
</div>
</div>
<div id="diagnostics" class="section level1">
<h1 class="hasAnchor">
<a href="#diagnostics" class="anchor"></a>Diagnostics</h1>
<p>We can perform several diagnostics on the data to verify whether our assumptions underlying the SCCS are met.</p>
<div id="time-from-exposure-start-to-event" class="section level2">
<h2 class="hasAnchor">
<a href="#time-from-exposure-start-to-event" class="anchor"></a>Time from exposure start to event</h2>
<p>To gain a better understanding of when the event occurs relative to the start of exposure, we can plot their relationship. Note that we specify the naive period, so this can be applied to the data prior to showing the plot. This will make the plot better in line with the data we ended up fitting:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="kw"><a href="../reference/plotExposureCentered.html">plotExposureCentered</a></span>(sccsData, <span class="dt">exposureId =</span> diclofenac, <span class="dt">naivePeriod =</span> <span class="dv">180</span>)</span></code></pre></div>
<pre><code>#&gt; Warning: Removed 52 rows containing missing values (geom_rect).</code></pre>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-49-1.png" width="624"></p>
<p>This plot suggests an increased rate of events in the first few weeks following the start of exposure, perhaps because of an acute effect.</p>
</div>
<div id="ages-covered-per-subject" class="section level2">
<h2 class="hasAnchor">
<a href="#ages-covered-per-subject" class="anchor"></a>Ages covered per subject</h2>
<p>We can visualize which age ranges are covered by each subject’s obervation time:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="kw"><a href="../reference/plotAgeSpans.html">plotAgeSpans</a></span>(sccsData, <span class="dt">naivePeriod =</span> <span class="dv">180</span>)</span></code></pre></div>
<pre><code>#&gt; Warning in plotAgeSpans(sccsData, naivePeriod = 180): There are 221908 cases,
#&gt; but can only reasonably show 10,000. Random sampling 10,000 cases.</code></pre>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-51-1.png" width="700"></p>
<p>Here we see that most observation periods span only a small age range, making it unlikely that any within-person age-related effect will be large.</p>
</div>
<div id="dependency-between-events-and-observation-end" class="section level2">
<h2 class="hasAnchor">
<a href="#dependency-between-events-and-observation-end" class="anchor"></a>Dependency between events and observation end</h2>
<p>To understand whether censoring is dependent on the event, which would violate one of the assumptions of the SCCS, we can plot the difference in distribution between censored and uncensored events. By ‘censored’ we mean periods that end before we would normally expect. Here, we define periods to be uncensored if they end at either the study end date (if specified), database end date (i.e. the date after which no data is captured in the database), or maximum age (if specified). All other periods are assumed to be censored.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw"><a href="../reference/plotEventObservationDependence.html">plotEventObservationDependence</a></span>(sccsData, <span class="dt">naivePeriod =</span> <span class="dv">180</span>)</span></code></pre></div>
<p><img src="SingleStudies_files/figure-html/unnamed-chunk-53-1.png" width="700"></p>
<p>Here we see that overall the two distributions are somewhat similar, with little evidence that censoring tends to lead to shorter times to the end of observation.</p>
</div>
</div>
<div id="acknowledgments" class="section level1">
<h1 class="hasAnchor">
<a href="#acknowledgments" class="anchor"></a>Acknowledgments</h1>
<p>Considerable work has been dedicated to provide the <code>SelfControlledCaseSeries</code> package.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span>(<span class="st">"SelfControlledCaseSeries"</span>)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; To cite package 'SelfControlledCaseSeries' in publications use:
#&gt; 
#&gt;   Martijn Schuemie, Patrick Ryan, Trevor Shaddox and Marc Suchard
#&gt;   (2020). SelfControlledCaseSeries: Self-Controlled Case Series. R
#&gt;   package version 1.4.1.
#&gt;   https://github.com/OHDSI/SelfControlledCaseSeries
#&gt; 
#&gt; A BibTeX entry for LaTeX users is
#&gt; 
#&gt;   @Manual{,
#&gt;     title = {SelfControlledCaseSeries: Self-Controlled Case Series},
#&gt;     author = {Martijn Schuemie and Patrick Ryan and Trevor Shaddox and Marc Suchard},
#&gt;     year = {2020},
#&gt;     note = {R package version 1.4.1},
#&gt;     url = {https://github.com/OHDSI/SelfControlledCaseSeries},
#&gt;   }</code></pre>
<p>Furthermore, <code>SelfControlledCaseSeries</code> makes extensive use of the <code>Cyclops</code> package.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw"><a href="https://rdrr.io/r/utils/citation.html">citation</a></span>(<span class="st">"Cyclops"</span>)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; To cite Cyclops in publications use:
#&gt; 
#&gt; Suchard MA, Simpson SE, Zorych I, Ryan P, Madigan D (2013). "Massive
#&gt; parallelization of serial inference algorithms for complex generalized
#&gt; linear models." _ACM Transactions on Modeling and Computer Simulation_,
#&gt; *23*, 10. &lt;URL: http://dl.acm.org/citation.cfm?id=2414791&gt;.
#&gt; 
#&gt; A BibTeX entry for LaTeX users is
#&gt; 
#&gt;   @Article{,
#&gt;     author = {M. A. Suchard and S. E. Simpson and I. Zorych and P. Ryan and D. Madigan},
#&gt;     title = {Massive parallelization of serial inference algorithms for complex generalized linear models},
#&gt;     journal = {ACM Transactions on Modeling and Computer Simulation},
#&gt;     volume = {23},
#&gt;     pages = {10},
#&gt;     year = {2013},
#&gt;     url = {http://dl.acm.org/citation.cfm?id=2414791},
#&gt;   }</code></pre>
<p>Part of the code (related to event-dependent observation periods) is based on the SCCS package by Yonas Ghebremichael-Weldeselassie, Heather Whitaker, and Paddy Farrington.</p>
<p>This work is supported in part through the National Science Foundation grant IIS 1251151.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#installation-instructions">Installation instructions</a></li>
      <li><a href="#overview">Overview</a></li>
      <li>
<a href="#studies-with-a-single-drug">Studies with a single drug</a><ul class="nav nav-pills nav-stacked">
<li><a href="#configuring-the-connection-to-the-server">Configuring the connection to the server</a></li>
      <li><a href="#preparing-the-health-outcome-of-interest">Preparing the health outcome of interest</a></li>
      <li><a href="#extracting-the-data-from-the-server">Extracting the data from the server</a></li>
      <li><a href="#defining-a-simple-model">Defining a simple model</a></li>
      <li><a href="#power-calculations">Power calculations</a></li>
      <li><a href="#model-fitting">Model fitting</a></li>
      <li><a href="#adding-a-pre-exposure-window">Adding a pre-exposure window</a></li>
      <li><a href="#splitting-risk-windows">Splitting risk windows</a></li>
      <li><a href="#including-age-and-seasonality">Including age and seasonality</a></li>
      <li><a href="#considering-event-dependent-observation-time">Considering event-dependent observation time</a></li>
      </ul>
</li>
      <li>
<a href="#studies-with-more-than-one-drug">Studies with more than one drug</a><ul class="nav nav-pills nav-stacked">
<li><a href="#adding-a-class-of-drugs">Adding a class of drugs</a></li>
      <li><a href="#adding-all-drugs">Adding all drugs</a></li>
      </ul>
</li>
      <li>
<a href="#diagnostics">Diagnostics</a><ul class="nav nav-pills nav-stacked">
<li><a href="#time-from-exposure-start-to-event">Time from exposure start to event</a></li>
      <li><a href="#ages-covered-per-subject">Ages covered per subject</a></li>
      <li><a href="#dependency-between-events-and-observation-end">Dependency between events and observation end</a></li>
      </ul>
</li>
      <li><a href="#acknowledgments">Acknowledgments</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Martijn Schuemie, Patrick Ryan, Trevor Shaddox, Marc Suchard.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
