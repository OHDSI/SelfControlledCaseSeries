<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Running multiple analyses at once using the SelfControlledCaseSeries package • SelfControlledCaseSeries</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Running multiple analyses at once using the SelfControlledCaseSeries package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SelfControlledCaseSeries</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">6.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/MultipleAnalyses.html">Running multiple analyses at once using the SelfControlledCaseSeries package</a></li>
    <li><a class="dropdown-item" href="../articles/ResultsSchema.html">Results schema of the SelfControlledCaseSeries package</a></li>
    <li><a class="dropdown-item" href="../articles/SingleStudies.html">Single studies using the SelfControlledCaseSeries package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://ohdsi.github.io/Hades"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/OHDSI/SelfControlledCaseSeries/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Running multiple analyses at once using the SelfControlledCaseSeries package</h1>
                        <h4 data-toc-skip class="author">Martijn J.
Schuemie</h4>
            
            <h4 data-toc-skip class="date">2025-06-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/OHDSI/SelfControlledCaseSeries/blob/HEAD/vignettes/MultipleAnalyses.Rmd" class="external-link"><code>vignettes/MultipleAnalyses.Rmd</code></a></small>
      <div class="d-none name"><code>MultipleAnalyses.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we focus on running several different analyses on
several exposure-outcome pairs This can be useful when we want to
explore the sensitivity to analyses choices, include controls, or run an
experiment similar to the OMOP experiment to empirically identify the
optimal analysis choices for a particular research question.</p>
<p>This vignette assumes you are already familiar with the
<code>SelfControlledCaseSeries</code> package and are able to perform
single studies. We will walk through all the steps needed to perform an
exemplar set of analyses, and we have selected the well-studied topic of
the effect of nonsteroidal anti-inflammatory drugs (NSAIDs) on
gastrointestinal (GI) bleeding-related hospitalization. For simplicity,
we focus on one NSAID: diclofenac. We will execute various variations of
an analysis for the primary exposure pair and a large set of negative
control exposures.</p>
</div>
<div class="section level2">
<h2 id="general-approach">General approach<a class="anchor" aria-label="anchor" href="#general-approach"></a>
</h2>
<p>The general approach to running a set of analyses is that you specify
all the function arguments of the functions you would normally call, and
create sets of these function arguments. The final outcome models as
well as intermediate data objects will all be saved to disk for later
extraction.</p>
<p>An analysis will be executed by calling these functions in
sequence:</p>
<ol style="list-style-type: decimal">
<li><code><a href="../reference/getDbSccsData.html">getDbSccsData()</a></code></li>
<li><code><a href="../reference/createStudyPopulation.html">createStudyPopulation()</a></code></li>
<li><code><a href="../reference/createSccsIntervalData.html">createSccsIntervalData()</a></code></li>
<li><code><a href="../reference/fitSccsModel.html">fitSccsModel()</a></code></li>
</ol>
<p>When you provide several analyses to the
<code>SelfControlledCaseSeries</code> package, it will determine whether
any of the analyses and exposure-outcome pairs have anything in common,
and will take advantage of this fact. For example, if we specify several
exposure-outcome pairs with the same outcome, the data for the outcome
will be extracted only once.</p>
<p>The function arguments you need to define have been divided into four
groups:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Exposures-outcome sets</strong>: arguments that are specific
to a hypothesis of interest, in the case of the self-controlled case
series this is a combination of one or more exposures and an
outcome.</li>
<li>
<strong>Analyses</strong>: arguments that are not directly specific
to a hypothesis of interest, such as the washout window, whether to
adjust for age and seasonality, etc.</li>
<li>Arguments that are the output of a previous function in the
<code>SelfControlledCaseSeries</code> package, such as the
<code>SccsIntervalData</code> argument of the
<code>createSccsIntervalData</code> function. These cannot be specified
by the user.</li>
<li>Arguments that are specific to an environment, such as the
connection details for connecting to the server, and the name of the
schema holding the CDM data.</li>
</ol>
<p>Arguments in groups 1 and 2 together fully specify the analyses, and
sharing these with other sites would allow them to fully reproduce the
study. Together, they are therefore referred to as the ‘SCCS analysis
specifications’.</p>
</div>
<div class="section level2">
<h2 id="preparation-for-the-example">Preparation for the example<a class="anchor" aria-label="anchor" href="#preparation-for-the-example"></a>
</h2>
<p>We need to tell R how to connect to the server where the data are.
<code>SelfControlledCaseSeries</code> uses the
<code>DatabaseConnector</code> package, which provides the
<code>createConnectionDetails</code> function. Type
<code>?createConnectionDetails</code> for the specific settings required
for the various database management systems (DBMS). For example, one
might connect to a PostgreSQL database using this code:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">createConnectionDetails</span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="st">"postgresql"</span>,</span>
<span>  server <span class="op">=</span> <span class="st">"localhost/ohdsi"</span>,</span>
<span>  user <span class="op">=</span> <span class="st">"joe"</span>,</span>
<span>  password <span class="op">=</span> <span class="st">"supersecret"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">outputFolder</span> <span class="op">&lt;-</span> <span class="st">"s:/temp/sccsVignette2"</span></span>
<span></span>
<span><span class="va">cdmDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"my_cdm_data"</span></span>
<span><span class="va">cohortDatabaseSchema</span> <span class="op">&lt;-</span> <span class="st">"my_cohorts"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>sqlRenderTempEmulationSchema <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<p>The last three lines define the <code>cdmDatabaseSchema</code> and
<code>cohortDatabaseSchema</code> variables, as well as the CDM version.
We’ll use these later to tell R where the data in CDM format live, where
we want to store the (outcome) cohorts, and what version CDM is used.
Note that for Microsoft SQL Server, databaseschemas need to specify both
the database and the schema, so for example
<code>cdmDatabaseSchema &lt;- "my_cdm_data.dbo"</code>.</p>
<p>We also need to prepare our exposures and outcomes of interest. The
drug_era table in the OMOP Common Data Model already contains
pre-specified cohorts of users at the ingredient level, so we will use
that for the exposures. For the outcome we can use the OHDSI
<code>PhenotypeLibrary</code> to retrieve a community-approved
definition of GI bleeding:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">giBleed</span> <span class="op">&lt;-</span> <span class="fl">77</span></span>
<span><span class="va">cohortDefinitionSet</span> <span class="op">&lt;-</span> <span class="fu">PhenotypeLibrary</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/PhenotypeLibrary/reference/getPlCohortDefinitionSet.html" class="external-link">getPlCohortDefinitionSet</a></span><span class="op">(</span><span class="va">giBleed</span><span class="op">)</span></span></code></pre></div>
<p>We can use the <code>CohortGenerator</code> package to instantiate
this cohort:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connection</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/connect.html" class="external-link">connect</a></span><span class="op">(</span><span class="va">connectionDetails</span><span class="op">)</span></span>
<span><span class="va">cohortTableNames</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/getCohortTableNames.html" class="external-link">getCohortTableNames</a></span><span class="op">(</span><span class="va">cohortTable</span><span class="op">)</span></span>
<span><span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/createCohortTables.html" class="external-link">createCohortTables</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                                    cohortDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>                                    cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span><span class="op">)</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu">CohortGenerator</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/CohortGenerator/reference/generateCohortSet.html" class="external-link">generateCohortSet</a></span><span class="op">(</span>connection <span class="op">=</span> <span class="va">connection</span>,</span>
<span>                                             cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>                                             cohortDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>                                             cohortTableNames <span class="op">=</span> <span class="va">cohortTableNames</span>,</span>
<span>                                             cohortDefinitionSet <span class="op">=</span> <span class="va">cohortDefinitionSet</span><span class="op">)</span></span>
<span><span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/disconnect.html" class="external-link">disconnect</a></span><span class="op">(</span><span class="va">connection</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="specifying-exposures-outcome-sets">Specifying exposures-outcome sets<a class="anchor" aria-label="anchor" href="#specifying-exposures-outcome-sets"></a>
</h2>
<p>The first group of arguments define the exposures and outcome. Here
we demonstrate how to create an exposures-outcome set:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diclofenac</span> <span class="op">&lt;-</span> <span class="fl">1124300</span></span>
<span><span class="va">negativeControls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">705178</span>, <span class="fl">705944</span>, <span class="fl">710650</span>, <span class="fl">714785</span>, <span class="fl">719174</span>, <span class="fl">719311</span>, <span class="fl">735340</span>, <span class="fl">742185</span>,</span>
<span>  <span class="fl">780369</span>, <span class="fl">781182</span>, <span class="fl">924724</span>, <span class="fl">990760</span>, <span class="fl">1110942</span>, <span class="fl">1111706</span>, <span class="fl">1136601</span>,</span>
<span>  <span class="fl">1317967</span>, <span class="fl">1501309</span>, <span class="fl">1505346</span>, <span class="fl">1551673</span>, <span class="fl">1560278</span>, <span class="fl">1584910</span>, <span class="fl">19010309</span>,</span>
<span>  <span class="fl">40163731</span></span>
<span><span class="op">)</span></span>
<span><span class="va">giBleed</span> <span class="op">&lt;-</span> <span class="fl">77</span></span>
<span></span>
<span><span class="va">exposuresOutcomeList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">exposuresOutcomeList</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createExposuresOutcome.html">createExposuresOutcome</a></span><span class="op">(</span></span>
<span>  outcomeId <span class="op">=</span> <span class="va">giBleed</span>,</span>
<span>  exposures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/createExposure.html">createExposure</a></span><span class="op">(</span>exposureId <span class="op">=</span> <span class="va">diclofenac</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">exposureId</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">negativeControls</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">exposuresOutcome</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createExposuresOutcome.html">createExposuresOutcome</a></span><span class="op">(</span></span>
<span>    outcomeId <span class="op">=</span> <span class="va">giBleed</span>,</span>
<span>    exposures <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/createExposure.html">createExposure</a></span><span class="op">(</span>exposureId <span class="op">=</span> <span class="va">exposureId</span>, trueEffectSize <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">exposuresOutcomeList</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">exposuresOutcomeList</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">exposuresOutcome</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We defined the outcome of interest to be the cohort with the ID
stored in <code>giBleed</code>. The exposures include diclofenac
(concept ID 1124300) and a large number of negative control exposures.
Note that for the negative controls we specify
<code>trueEffectSize = 1</code> since we assume negative controls have
no causal effect on the outcome.</p>
<p>A convenient way to save <code>exposuresOutcomeList</code> to file is
by using the <code>saveExposuresOutcomeList</code> function, and we can
load it again using the <code>loadExposuresOutcomeList</code>
function.</p>
</div>
<div class="section level2">
<h2 id="specifying-analyses">Specifying analyses<a class="anchor" aria-label="anchor" href="#specifying-analyses"></a>
</h2>
<p>The second group of arguments are not specific to a hypothesis of
interest, and comprise the majority of arguments. For each function that
will be called during the execution of the analyses there is a companion
function that creates the core settings for that function. For example,
for the <code><a href="../reference/fitSccsModel.html">fitSccsModel()</a></code> function there is the
<code><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs()</a></code> function. These companion
functions can be used to create the arguments to be used during
execution:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">getDbSccsDataArgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createGetDbSccsDataArgs.html">createGetDbSccsDataArgs</a></span><span class="op">(</span></span>
<span>  deleteCovariatesSmallCount <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  exposureIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  maxCasesPerOutcome <span class="op">=</span> <span class="fl">100000</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createStudyPopulationArgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCreateStudyPopulationArgs.html">createCreateStudyPopulationArgs</a></span><span class="op">(</span></span>
<span>  naivePeriod <span class="op">=</span> <span class="fl">180</span>,</span>
<span>  firstOutcomeOnly <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarExposureOfInt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Exposure of interest"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="st">"exposureId"</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era end"</span>,</span>
<span>  profileLikelihood <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  exposureOfInterest <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createSccsIntervalDataArgs1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>  eraCovariateSettings <span class="op">=</span> <span class="va">covarExposureOfInt</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fitSccsModelArgs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createFitSccsModelArgs.html">createFitSccsModelArgs</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Any argument that is not explicitly specified by the user will assume
the default value specified in the companion function. Note that for
several arguments for concept or cohort definition IDs we can use the
<code>exposureIdRef</code> (default = <code>"exposureId"</code>) in the
<code>Exposure</code> objects that we used in
<code><a href="../reference/createExposuresOutcome.html">createExposuresOutcome()</a></code>. In this case, we defined the
argument <code>includeEraIds</code> to get the value of the
<code>exposureId</code> variable, meaning it will take the value of the
diclofenac concept ID, or any of the negative control IDs. Also note
that we set <code>exposureOfInterest = TRUE</code>, which will cause the
estimate for this covariate to be included in the result summary later
on.</p>
<p><strong>Important: at least one era covariate in your analysis must
have <code>exposureOfInterest = TRUE</code>.</strong></p>
<p>We can now combine the arguments for the various functions into a
single analysis:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsAnalysis1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsAnalysis.html">createSccsAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Simplest model"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="va">getDbSccsDataArgs</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="va">createStudyPopulationArgs</span>,</span>
<span>  createIntervalDataArgs <span class="op">=</span> <span class="va">createSccsIntervalDataArgs1</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="va">fitSccsModelArgs</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Note that we have assigned an analysis ID (1) to this set of
arguments. We can use this later to link the results back to this
specific set of choices. We also include a short description of the
analysis.</p>
<p>We can easily create more analyses, for example by including
adjustments for age and seasonality, or for including other drugs in the
model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ppis</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">911735</span>, <span class="fl">929887</span>, <span class="fl">923645</span>, <span class="fl">904453</span>, <span class="fl">948078</span>, <span class="fl">19039926</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarPreExp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Pre-exposure"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="st">"exposureId"</span>,</span>
<span>  start <span class="op">=</span> <span class="op">-</span><span class="fl">30</span>,</span>
<span>  end <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era start"</span>,</span>
<span>  preExposure <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarProphylactics</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Prophylactics"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="va">ppis</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era end"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createSccsIntervalDataArgs2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>  eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">covarExposureOfInt</span>,</span>
<span>    <span class="va">covarPreExp</span>,</span>
<span>    <span class="va">covarProphylactics</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsAnalysis2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsAnalysis.html">createSccsAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Including prophylactics and pre-exposure"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="va">getDbSccsDataArgs</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="va">createStudyPopulationArgs</span>,</span>
<span>  createIntervalDataArgs <span class="op">=</span> <span class="va">createSccsIntervalDataArgs2</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="va">fitSccsModelArgs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">seasonalitySettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSeasonalityCovariateSettings.html">createSeasonalityCovariateSettings</a></span><span class="op">(</span>seasonKnots <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">calendarTimeSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCalendarTimeCovariateSettings.html">createCalendarTimeCovariateSettings</a></span><span class="op">(</span>calendarTimeKnots <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">createSccsIntervalDataArgs3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>  eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">covarExposureOfInt</span>,</span>
<span>    <span class="va">covarPreExp</span>,</span>
<span>    <span class="va">covarProphylactics</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalitySettings</span>,</span>
<span>  calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsAnalysis3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsAnalysis.html">createSccsAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Including prophylactics, season, calendar time, and pre-exposure"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="va">getDbSccsDataArgs</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="va">createStudyPopulationArgs</span>,</span>
<span>  createIntervalDataArgs <span class="op">=</span> <span class="va">createSccsIntervalDataArgs3</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="va">fitSccsModelArgs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">covarAllDrugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"Other exposures"</span>,</span>
<span>  includeEraIds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  excludeEraIds <span class="op">=</span> <span class="st">"exposureId"</span>,</span>
<span>  stratifyById <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  start <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  end <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"era end"</span>,</span>
<span>  allowRegularization <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createSccsIntervalDataArgs4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>  eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">covarExposureOfInt</span>,</span>
<span>    <span class="va">covarPreExp</span>,</span>
<span>    <span class="va">covarAllDrugs</span></span>
<span>  <span class="op">)</span>,</span>
<span>  seasonalityCovariateSettings <span class="op">=</span> <span class="va">seasonalitySettings</span>,</span>
<span>  calendarTimeCovariateSettings <span class="op">=</span> <span class="va">calendarTimeSettings</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsAnalysis4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsAnalysis.html">createSccsAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Including all other drugs"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="va">getDbSccsDataArgs</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="va">createStudyPopulationArgs</span>,</span>
<span>  createIntervalDataArgs <span class="op">=</span> <span class="va">createSccsIntervalDataArgs4</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="va">fitSccsModelArgs</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">createSccsIntervalDataArgs5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCreateSccsIntervalDataArgs.html">createCreateSccsIntervalDataArgs</a></span><span class="op">(</span></span>
<span>  eraCovariateSettings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">covarExposureOfInt</span>,</span>
<span>    <span class="va">covarPreExp</span>,</span>
<span>    <span class="va">covarProphylactics</span></span>
<span>  <span class="op">)</span>,</span>
<span>  eventDependentObservation <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sccsAnalysis5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsAnalysis.html">createSccsAnalysis</a></span><span class="op">(</span></span>
<span>  analysisId <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  description <span class="op">=</span> <span class="st">"Adjusting for event-dependent obs. end"</span>,</span>
<span>  getDbSccsDataArgs <span class="op">=</span> <span class="va">getDbSccsDataArgs</span>,</span>
<span>  createStudyPopulationArgs <span class="op">=</span> <span class="va">createStudyPopulationArgs</span>,</span>
<span>  createIntervalDataArgs <span class="op">=</span> <span class="va">createSccsIntervalDataArgs5</span>,</span>
<span>  fitSccsModelArgs <span class="op">=</span> <span class="va">fitSccsModelArgs</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>These analyses can be combined in a list:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsAnalysisList</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">sccsAnalysis1</span>,</span>
<span>  <span class="va">sccsAnalysis2</span>,</span>
<span>  <span class="va">sccsAnalysis3</span>,</span>
<span>  <span class="va">sccsAnalysis4</span>,</span>
<span>  <span class="va">sccsAnalysis5</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A convenient way to save <code>sccsAnalysisList</code> to file is by
using the <code>saveSccsAnalysisList</code> function, and we can load it
again using the <code>loadSccsAnalysisList</code> function.</p>
<p>We combine the exposures-outcomes and analysis lists into the full
<code>sccsAnalysisSpecifications</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsAnalysesSpecifications</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createSccsAnalysesSpecifications.html">createSccsAnalysesSpecifications</a></span><span class="op">(</span></span>
<span>  sccsAnalysisList <span class="op">=</span> <span class="va">sccsAnalysisList</span>,</span>
<span>  exposuresOutcomeList <span class="op">=</span> <span class="va">exposuresOutcomeList</span>,</span>
<span>  controlType <span class="op">=</span> <span class="st">"exposure"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This specifies we will run all analyses against all hypotheses of
interest, meaning that the total number of outcome models is
<code>length(sccsAnalysisList) * length(exposuresOutcomeList)</code>.
(If we want, we can skip some of these combinations using the
<code>analysesToExclude</code> argument of
<code><a href="../reference/createSccsAnalysesSpecifications.html">createSccsAnalysesSpecifications()</a></code>.)</p>
</div>
<div class="section level2">
<h2 id="executing-multiple-analyses">Executing multiple analyses<a class="anchor" aria-label="anchor" href="#executing-multiple-analyses"></a>
</h2>
<p>We can now run the specified analyses using the
<code><a href="../reference/runSccsAnalyses.html">runSccsAnalyses()</a></code> function:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">multiThreadingSettings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createDefaultSccsMultiThreadingSettings.html">createDefaultSccsMultiThreadingSettings</a></span><span class="op">(</span></span>
<span>  <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">referenceTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSccsAnalyses.html">runSccsAnalyses</a></span><span class="op">(</span></span>
<span>  connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>,</span>
<span>  cdmDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"drug_era"</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">cohortDatabaseSchema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="va">cohortTable</span>,</span>
<span>  outputFolder <span class="op">=</span> <span class="va">outputFolder</span>,</span>
<span>  sccsMultiThreadingSettings <span class="op">=</span> <span class="va">multiThreadingSettings</span>,</span>
<span>  sccsAnalysesSpecifications <span class="op">=</span> <span class="va">sccsAnalysesSpecifications</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In the code above, we first specify how many parallel threads
<code>SelfControlledCaseSeries</code> can use. Many of the computations
can be computed in parallel, and providing more than one CPU core can
greatly speed up the computation. Here we specify
<code>SelfControlledCaseSeries</code> can use all but one of the CPU
cores detected in the system (using the
<code><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">parallel::detectCores()</a></code> function).</p>
<p>We call <code>runSccsAnalyses</code>, providing the arguments for
connecting to the database, which schemas and tables to use, as well as
the analyses and hypotheses of interest. The <code>outputFolder</code>
specifies where the outcome models and intermediate files will be
written. Because in this example we use negative control exposures, we
must explicitly specify <code>controlType = "exposure"</code>. This will
cause the different negative control exposure-outcome pairs to be used
for the same outcome.</p>
<div class="section level3">
<h3 id="restarting">Restarting<a class="anchor" aria-label="anchor" href="#restarting"></a>
</h3>
<p>If for some reason the execution was interrupted, you can restart by
re-issuing the <code><a href="../reference/runSccsAnalyses.html">runSccsAnalyses()</a></code> command. Any intermediate
and final products that have already been completed and written to disk
will be skipped.</p>
</div>
</div>
<div class="section level2">
<h2 id="retrieving-the-results">Retrieving the results<a class="anchor" aria-label="anchor" href="#retrieving-the-results"></a>
</h2>
<p>The result of the <code><a href="../reference/runSccsAnalyses.html">runSccsAnalyses()</a></code> is a data frame with
one row per exposures-outcome-analysis combination, so one row per
fitted SCCS model. It provides the file names of the intermediate and
end-result files that were constructed. For example, we can retrieve the
fitted model for the combination of our drug of interest, outcome, and
first analysis:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sccsModelFile</span> <span class="op">&lt;-</span> <span class="va">referenceTable</span><span class="op">$</span><span class="va">sccsModelFile</span><span class="op">[</span><span class="va">result</span><span class="op">$</span><span class="va">exposureId</span> <span class="op">==</span> <span class="va">diclofenac</span> <span class="op">&amp;</span></span>
<span>                                                <span class="va">referenceTable</span><span class="op">$</span><span class="va">outcomeId</span> <span class="op">==</span> <span class="va">giBleed</span> <span class="op">&amp;</span></span>
<span>                                                <span class="va">referenceTable</span><span class="op">$</span><span class="va">analysisId</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">sccsModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">outputFolder</span>, <span class="va">sccsModelFile</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sccsModel</span></span></code></pre></div>
<pre><code><span><span class="co">## SccsModel object</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome ID: 77</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Outcome count:</span></span>
<span><span class="co">##    outcomeSubjects outcomeEvents outcomeObsPeriods observedDays</span></span>
<span><span class="co">## 77           88644        162059             88874    187523199</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Estimates:</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">##   Name                         ID Estimate LB95CI UB95CI LogRr SeLogRr</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> End of observation period    99     2.14   2.09   2.19 0.760  0.011<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> Exposure of interest       <span style="text-decoration: underline;">1</span>000     1.22   1.15   1.30 0.200  0.031<span style="text-decoration: underline;">7</span></span></span></code></pre>
<p>Note that some of the file names will appear several times in the
table. In our example all analysis share the same <code>sccsData</code>
object.</p>
<p>We can always retrieve the file reference table again using the
<code><a href="../reference/getFileReference.html">getFileReference()</a></code> function:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">referenceTable</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getFileReference.html">getFileReference</a></span><span class="op">(</span><span class="va">outputFolder</span><span class="op">)</span></span></code></pre></div>
<p>We can get a summary of the results using
<code><a href="../reference/getResultsSummary.html">getResultsSummary()</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resultsSum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getResultsSummary.html">getResultsSummary</a></span><span class="op">(</span><span class="va">outputFolder</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">resultsSum</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 32</span></span></span>
<span><span class="co">##   exposuresOutcomeSetId nestingCohortId outcomeId analysisId covariateAnalysisId</span></span>
<span><span class="co">##                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>            <span style="text-decoration: underline;">1</span>480<span style="text-decoration: underline;">556</span>481              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>            <span style="text-decoration: underline;">1</span>039<span style="text-decoration: underline;">014</span>262              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>           -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">616</span><span style="color: #BB0000; text-decoration: underline;">427</span><span style="color: #BB0000;">546</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>           -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">774</span><span style="color: #BB0000; text-decoration: underline;">200</span><span style="color: #BB0000;">863</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>            -<span style="color: #BB0000;">612</span><span style="color: #BB0000; text-decoration: underline;">981</span><span style="color: #BB0000;">155</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>           -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">166</span><span style="color: #BB0000; text-decoration: underline;">912</span><span style="color: #BB0000;">124</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 27 more variables: covariateId &lt;dbl&gt;, covariateName &lt;chr&gt;, eraId &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   trueEffectSize &lt;int&gt;, outcomeSubjects &lt;dbl&gt;, outcomeEvents &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   outcomeObservationPeriods &lt;dbl&gt;, observedDays &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   covariateSubjects &lt;dbl&gt;, covariateDays &lt;dbl&gt;, covariateEras &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   covariateOutcomes &lt;dbl&gt;, rr &lt;dbl&gt;, ci95Lb &lt;dbl&gt;, ci95Ub &lt;dbl&gt;, p &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   oneSidedP &lt;dbl&gt;, logRr &lt;dbl&gt;, seLogRr &lt;dbl&gt;, llr &lt;dbl&gt;, calibratedRr &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   calibratedCi95Lb &lt;dbl&gt;, calibratedCi95Ub &lt;dbl&gt;, calibratedP &lt;dbl&gt;, …</span></span></span></code></pre>
<p>This tells us, per exposure-outcome-analysis combination (so possible
multiple rows per SCCS model) the estimated relative risk and 95%
confidence interval, as well as the number of subjects (cases) and the
number of events observed for those subjects. The only covariates
included in this summary are those we marked with
<code>exposureOfInterest = TRUE</code> when calling
<code><a href="../reference/createEraCovariateSettings.html">createEraCovariateSettings()</a></code> earlier.</p>
<div class="section level3">
<h3 id="diagnostics-summary">Diagnostics summary<a class="anchor" aria-label="anchor" href="#diagnostics-summary"></a>
</h3>
<p>The <code><a href="../reference/runSccsAnalyses.html">runSccsAnalyses()</a></code> function automatically executes
diagnostics for the major assumptions of the SCCS design. You can view a
summary of the diagnostics results:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnosticsSum</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getDiagnosticsSummary.html">getDiagnosticsSummary</a></span><span class="op">(</span><span class="va">outputFolder</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">diagnosticsSum</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 24</span></span></span>
<span><span class="co">##   exposuresOutcomeSetId nestingCohortId outcomeId analysisId covariateAnalysisId</span></span>
<span><span class="co">##                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>            <span style="text-decoration: underline;">1</span>480<span style="text-decoration: underline;">556</span>481              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>            <span style="text-decoration: underline;">1</span>039<span style="text-decoration: underline;">014</span>262              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>           -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">616</span><span style="color: #BB0000; text-decoration: underline;">427</span><span style="color: #BB0000;">546</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>           -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">774</span><span style="color: #BB0000; text-decoration: underline;">200</span><span style="color: #BB0000;">863</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>            -<span style="color: #BB0000;">612</span><span style="color: #BB0000; text-decoration: underline;">981</span><span style="color: #BB0000;">155</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>           -<span style="color: #BB0000; text-decoration: underline;">1</span><span style="color: #BB0000;">166</span><span style="color: #BB0000; text-decoration: underline;">912</span><span style="color: #BB0000;">124</span>              <span style="color: #BB0000;">NA</span>        77          1                   1</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 19 more variables: covariateId &lt;dbl&gt;, covariateName &lt;chr&gt;, eraId &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   timeStabilityP &lt;dbl&gt;, timeStabilityDiagnostic &lt;chr&gt;, eventExposureLb &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventExposureUb &lt;dbl&gt;, eventExposureDiagnostic &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventObservationLb &lt;dbl&gt;, eventObservationUb &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   eventObservationDiagnostic &lt;chr&gt;, rareOutcomePrevalence &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   rareOutcomeDiagnostic &lt;chr&gt;, mdrr &lt;dbl&gt;, mdrrDiagnostic &lt;chr&gt;, ease &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   easeDiagnostic &lt;chr&gt;, unblind &lt;lgl&gt;, unblindForEvidenceSynthesis &lt;lgl&gt;</span></span></span></code></pre>
<p>For each of the diagnostics, this summary reports whether an analysis
failed or passed the diagnostic. The thresholds used can be specified in
the <code><a href="../reference/createSccsAnalysesSpecifications.html">createSccsAnalysesSpecifications()</a></code> function.</p>
</div>
<div class="section level3">
<h3 id="negative-control-distribution">Negative control distribution<a class="anchor" aria-label="anchor" href="#negative-control-distribution"></a>
</h3>
<p>Now that we have produced estimates for all outcomes including our
negative controls, we can look at the distribution of negative controls.
In each plot, the blue dots represent our negative control exposures,
and the yellow diamond represents our exposure of interest: diclofenac.
An unbiased, well-calibrated analysis should have 95% of the negative
controls between the dashed lines (ie. 95% should have p &gt; .05). Note
that empirical calibration was already automatically performed, and
calibrated confidence intervals and p-values are included separately in
the analyses summary.</p>
<p>Before viewing the estimates, we should remove those that fail one of
our diagnostics. For the first analysis, that means none of the
estimates remain:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"EmpiricalCalibration"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ohdsi.github.io/EmpiricalCalibration/" class="external-link">EmpiricalCalibration</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analysis 1: Simplest model</span></span>
<span><span class="va">analysis1Estimates</span> <span class="op">&lt;-</span>  <span class="va">resultsSum</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">diagnosticsSum</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">analysisId</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">unblind</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">analysis1Estimates</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>The same is true for analysis 2:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># Analysis 2: Including prophylactics and pre-exposure</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  analysis2Estimates <span class="ot">&lt;-</span>  resultsSum <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>    <span class="fu">inner_join</span>(diagnosticsSum) <span class="sc">|&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>    <span class="fu">filter</span>(analysisId <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> unblind <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  </span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="fu">nrow</span>(analysis2Estimates)</span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a><span class="er">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>Only when we start to include corrections for season and calendar
time do we pass diagnostics:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analysis 3: Including prophylactics, season, calendar time, and pre-exposure</span></span>
<span>  <span class="va">analysis3Estimates</span> <span class="op">&lt;-</span>  <span class="va">resultsSum</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">inner_join</span><span class="op">(</span><span class="va">diagnosticsSum</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">analysisId</span> <span class="op">==</span> <span class="fl">3</span> <span class="op">&amp;</span> <span class="va">unblind</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">negCons</span> <span class="op">&lt;-</span> <span class="va">analysis3Estimates</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">eraId</span> <span class="op">!=</span> <span class="va">diclofenac</span><span class="op">)</span></span>
<span>  <span class="va">ei</span> <span class="op">&lt;-</span> <span class="va">negCons</span> <span class="op">&lt;-</span> <span class="va">analysis3Estimates</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">eraId</span> <span class="op">==</span> <span class="va">diclofenac</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://ohdsi.github.io/EmpiricalCalibration/reference/plotCalibrationEffect.html" class="external-link">plotCalibrationEffect</a></span><span class="op">(</span></span>
<span>    logRrNegatives <span class="op">=</span> <span class="va">negCons</span><span class="op">$</span><span class="va">logRr</span>,</span>
<span>    seLogRrNegatives <span class="op">=</span> <span class="va">negCons</span><span class="op">$</span><span class="va">seLogRr</span>,</span>
<span>    logRrPositives <span class="op">=</span> <span class="va">ei</span><span class="op">$</span><span class="va">logRr</span>,</span>
<span>    seLogRrPositives <span class="op">=</span> <span class="va">ei</span><span class="op">$</span><span class="va">seLogRr</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="MultipleAnalyses_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analysis 4: Including all other drugs</span></span>
<span><span class="va">negCons</span> <span class="op">&lt;-</span> <span class="va">resultsSum</span><span class="op">[</span><span class="va">resultsSum</span><span class="op">$</span><span class="va">analysisId</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">resultsSum</span><span class="op">$</span><span class="va">eraId</span> <span class="op">!=</span> <span class="va">diclofenac</span>, <span class="op">]</span></span>
<span><span class="va">ei</span> <span class="op">&lt;-</span> <span class="va">resultsSum</span><span class="op">[</span><span class="va">resultsSum</span><span class="op">$</span><span class="va">analysisId</span> <span class="op">==</span> <span class="fl">4</span> <span class="op">&amp;</span> <span class="va">resultsSum</span><span class="op">$</span><span class="va">eraId</span> <span class="op">==</span> <span class="va">diclofenac</span>, <span class="op">]</span></span>
<span><span class="va">null</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ohdsi.github.io/EmpiricalCalibration/reference/fitNull.html" class="external-link">fitNull</a></span><span class="op">(</span></span>
<span>  <span class="va">negCons</span><span class="op">$</span><span class="va">logRr</span>,</span>
<span>  <span class="va">negCons</span><span class="op">$</span><span class="va">seLogRr</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ohdsi.github.io/EmpiricalCalibration/reference/plotCalibrationEffect.html" class="external-link">plotCalibrationEffect</a></span><span class="op">(</span></span>
<span>  logRrNegatives <span class="op">=</span> <span class="va">negCons</span><span class="op">$</span><span class="va">logRr</span>,</span>
<span>  seLogRrNegatives <span class="op">=</span> <span class="va">negCons</span><span class="op">$</span><span class="va">seLogRr</span>,</span>
<span>  logRrPositives <span class="op">=</span> <span class="va">ei</span><span class="op">$</span><span class="va">logRr</span>,</span>
<span>  seLogRrPositives <span class="op">=</span> <span class="va">ei</span><span class="op">$</span><span class="va">seLogRr</span>,</span>
<span>  <span class="va">null</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="MultipleAnalyses_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
<p>When using the adjustment for event-dependent observation end we do
not pass diagnostics for any exposure-outcome pair:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Analysis 5: Adjusting for event-dependent obs. end</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">analysis5Estimates</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>Considerable work has been dedicated to provide the
<code>SelfControlledCaseSeries</code> package.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"SelfControlledCaseSeries"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## To cite package 'SelfControlledCaseSeries' in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Schuemie M, Ryan P, Shaddox T, Suchard M (2025).</span></span>
<span><span class="co">##   _SelfControlledCaseSeries: Self-Controlled Case Series_. R package</span></span>
<span><span class="co">##   version 6.0.0, https://github.com/OHDSI/SelfControlledCaseSeries,</span></span>
<span><span class="co">##   &lt;https://ohdsi.github.io/SelfControlledCaseSeries/&gt;.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Manual{,</span></span>
<span><span class="co">##     title = {SelfControlledCaseSeries: Self-Controlled Case Series},</span></span>
<span><span class="co">##     author = {Martijn Schuemie and Patrick Ryan and Trevor Shaddox and Marc Suchard},</span></span>
<span><span class="co">##     year = {2025},</span></span>
<span><span class="co">##     note = {R package version 6.0.0, </span></span>
<span><span class="co">## https://github.com/OHDSI/SelfControlledCaseSeries},</span></span>
<span><span class="co">##     url = {https://ohdsi.github.io/SelfControlledCaseSeries/},</span></span>
<span><span class="co">##   }</span></span></code></pre>
<p>Further, <code>SelfControlledCaseSeries</code> makes extensive use of
the <code>Cyclops</code> package.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"Cyclops"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## To cite Cyclops in publications use:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   Suchard MA, Simpson SE, Zorych I, Ryan P, Madigan D (2013). "Massive</span></span>
<span><span class="co">##   parallelization of serial inference algorithms for complex</span></span>
<span><span class="co">##   generalized linear models." _ACM Transactions on Modeling and</span></span>
<span><span class="co">##   Computer Simulation_, *23*, 10. doi:10.1145/2414416.2414791</span></span>
<span><span class="co">##   &lt;https://doi.org/10.1145/2414416.2414791&gt;.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   @Article{,</span></span>
<span><span class="co">##     author = {M. A. Suchard and S. E. Simpson and I. Zorych and P. Ryan and D. Madigan},</span></span>
<span><span class="co">##     title = {Massive parallelization of serial inference algorithms for complex generalized linear models},</span></span>
<span><span class="co">##     journal = {ACM Transactions on Modeling and Computer Simulation},</span></span>
<span><span class="co">##     volume = {23},</span></span>
<span><span class="co">##     pages = {10},</span></span>
<span><span class="co">##     year = {2013},</span></span>
<span><span class="co">##     doi = {10.1145/2414416.2414791},</span></span>
<span><span class="co">##   }</span></span></code></pre>
<p>This work is supported in part through the National Science
Foundation grant IIS 1251151.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martijn Schuemie, Patrick Ryan, Trevor Shaddox, Marc Suchard.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
